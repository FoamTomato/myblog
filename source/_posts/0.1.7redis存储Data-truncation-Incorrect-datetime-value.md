---
title: 'redis存储Data truncation: Incorrect datetime value'
date: 2022-03-07 22:24:57
tags:
    - java 
    - redis
    - bug
top_img: https://browser9.qhimg.com/bdr/__85/t01bbd94b90e850d1d3.jpg
cover: https://fastly.jsdelivr.net/gh/FoamTomato/images/imgs/IMG_20200704_194539.jpg
---
最近在编写项目时，用redis存储结果一直报转换异常
![在这里插入图片描述](https://fastly.jsdelivr.net/gh/FoamTomato/images/imgs/f0a78853cfed40ad8b8a8b35800a7f52.png)
对此我有了以下思路
1.在mysql进行格式转换
2.在java先转换
3.存json之前就进行格式转换

但是以上方法都不行，因为数据需要的是date类型，如果走转换又过慢
![在这里插入图片描述](https://fastly.jsdelivr.net/gh/FoamTomato/images/imgs/374ed7336a77406f90aa8dc2ea8b4530.png)
有大佬提了一下使用序列化解决，我就尝试了一下，还真可以,以下是我编写思路
1.首先需要序列化的类继承Serializable接口
![在这里插入图片描述](https://fastly.jsdelivr.net/gh/FoamTomato/images/imgs/aeb43a6c0aef4058802e25afc80b6253.png)
2.编写序列化工具类

```java
package com.tiantai.policy.utils;

import java.io.*;

public class SerializeUtil {
    // 序列化
    public static byte[] serialize(Object object) {

        ObjectOutputStream oos = null;
        ByteArrayOutputStream baos = null;
        byte[] bytes = null;
        try {
            baos = new ByteArrayOutputStream();
            oos = new ObjectOutputStream(baos);
            oos.writeObject(object);
            bytes = baos.toByteArray();
        } catch (Exception e) {
            System.err.println("序列化失败" + e.getMessage());
        }
        return bytes;
    }

    // 反序列化
    public static Object deserialize(byte[] bytes) throws IOException, ClassNotFoundException {

        ByteArrayInputStream bais = null;
        ObjectInputStream ois = null;
        try {
            bais = new ByteArrayInputStream(bytes);
            ois = new ObjectInputStream(bais);
        } catch (Exception e) {
            System.err.println("反序列化失败" + e.getMessage());
        }
        return ois.readObject();
    }
}
```
3.使用序列化存储

```java
HashMap<Integer , Object> objectObjectHashMap = new HashMap<>();
                                objectObjectHashMap.put(airChannelEnum.getType(), SerializeUtil.serialize(selectPage));
                                redisTemplate.opsForList().leftPush("error",gson.toJson(objectObjectHashMap));

```
![在这里插入图片描述](https://fastly.jsdelivr.net/gh/FoamTomato/images/imgs/cb7066c9f316480a85b9e0864992880e.png)
4.反序列化读取
![在这里插入图片描述](https://fastly.jsdelivr.net/gh/FoamTomato/images/imgs/a2bbe2c6ba594e29a77afa1c7016881b.png)

```java
Page deserialize = (Page)SerializeUtil.deserialize(entry.getValue());
```
第一个红框是我用gson进行json转换
第二个红框是序列化后强转为原对象
<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Java+Milvusæ­å»ºä¼ä¸šçº§RAGç³»ç»Ÿ | å–µå–µé±¼å¡˜</title><meta name="author" content="FoamğŸ…"><meta name="copyright" content="FoamğŸ…"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="éšç€å¤§è¯­è¨€æ¨¡å‹çš„å¿«é€Ÿå‘å±•ï¼Œä¼ä¸šå¸Œæœ›å°†å…¶åº”ç”¨äºå†…éƒ¨çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿã€‚RAGï¼ˆRetrieval Augmented Generationï¼‰æŠ€æœ¯é€šè¿‡ç»“åˆå‘é‡æ£€ç´¢å’Œç”Ÿæˆå¼AIï¼Œä¸ºä¼ä¸šæä¾›ç²¾å‡†ã€å®æ—¶çš„çŸ¥è¯†é—®ç­”èƒ½åŠ›ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Java+Milvusæ­å»ºä¸€å¥—ä¼ä¸šçº§çš„RAGç³»ç»Ÿã€‚  å¼•è¨€ä¸ºä»€ä¹ˆéœ€è¦ä¼ä¸š"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://foamtomato.github.io/2025/08/03/0.5.7-Java+Milvus%E6%90%AD%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%BA%A7RAG%E7%B3%BB%E7%BB%9F/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Java+Milvusæ­å»ºä¼ä¸šçº§RAGç³»ç»Ÿ',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-29 18:13:30'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/static-butterfly/dist/css/index.min.css"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"><style>
/* ä¿®å¤JetBrains Monoå­—ä½“å¼•ç”¨ */
@font-face {
  font-family: 'MyFont';
  src: url('https://cdn.jsdelivr.net/gh/JetBrains/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2') format('woff2'),
       url('https://cdn.jsdelivr.net/gh/JetBrains/JetBrainsMono/web/woff/JetBrainsMono-Regular.woff') format('woff');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
</style>
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.ico" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">57</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">68</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é±¼å¡˜</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å–µç”Ÿ</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> å…³é”®è¯</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> çŒ«ç‰‡</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> çŒ«ã®å‹</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> è¯­å½•</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://images.unsplash.com/photo-1677442136019-21780ecad995?w=1200&amp;h=400&amp;fit=crop')"><nav id="nav"><span id="blog-info"><a href="/" title="å–µå–µé±¼å¡˜"><span class="site-name">å–µå–µé±¼å¡˜</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é±¼å¡˜</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å–µç”Ÿ</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> å…³é”®è¯</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> çŒ«ç‰‡</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> çŒ«ã®å‹</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> è¯­å½•</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Java+Milvusæ­å»ºä¼ä¸šçº§RAGç³»ç»Ÿ</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-08-03T07:56:49.000Z" title="å‘è¡¨äº 2025-08-03 15:56:49">2025-08-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-08-29T10:13:30.585Z" title="æ›´æ–°äº 2025-08-29 18:13:30">2025-08-29</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Java+Milvusæ­å»ºä¼ä¸šçº§RAGç³»ç»Ÿ"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>éšç€å¤§è¯­è¨€æ¨¡å‹çš„å¿«é€Ÿå‘å±•ï¼Œä¼ä¸šå¸Œæœ›å°†å…¶åº”ç”¨äºå†…éƒ¨çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿã€‚RAGï¼ˆRetrieval Augmented Generationï¼‰æŠ€æœ¯é€šè¿‡ç»“åˆå‘é‡æ£€ç´¢å’Œç”Ÿæˆå¼AIï¼Œä¸ºä¼ä¸šæä¾›ç²¾å‡†ã€å®æ—¶çš„çŸ¥è¯†é—®ç­”èƒ½åŠ›ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Java+Milvusæ­å»ºä¸€å¥—ä¼ä¸šçº§çš„RAGç³»ç»Ÿã€‚</p>
</blockquote>
<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><h3 id="ä¸ºä»€ä¹ˆéœ€è¦ä¼ä¸šçº§RAGç³»ç»Ÿï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ä¼ä¸šçº§RAGç³»ç»Ÿï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ä¼ä¸šçº§RAGç³»ç»Ÿï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ä¼ä¸šçº§RAGç³»ç»Ÿï¼Ÿ</h3><p>ä¼ ç»Ÿçš„LLMåº”ç”¨å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li><strong>çŸ¥è¯†æ—¶æ•ˆæ€§å·®</strong>ï¼šæ¨¡å‹è®­ç»ƒæ•°æ®æœ‰æˆªæ­¢æ—¶é—´</li>
<li><strong>é¢†åŸŸçŸ¥è¯†ä¸è¶³</strong>ï¼šé€šç”¨æ¨¡å‹ç¼ºä¹ä¼ä¸šç‰¹å®šçŸ¥è¯†</li>
<li><strong>å¹»è§‰é—®é¢˜ä¸¥é‡</strong>ï¼šæ¨¡å‹å®¹æ˜“ç”Ÿæˆä¸å­˜åœ¨çš„ä¿¡æ¯</li>
<li><strong>æ•°æ®å®‰å…¨éšæ‚£</strong>ï¼šä¼ä¸šæ•æ„Ÿæ•°æ®æ— æ³•ç›´æ¥è¾“å…¥</li>
</ul>
<p>RAGæŠ€æœ¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³è¿™äº›é—®é¢˜ï¼š</p>
<ol>
<li><strong>å®æ—¶çŸ¥è¯†æ›´æ–°</strong>ï¼šå¯ä»¥å³æ—¶çº³å…¥æœ€æ–°ä¼ä¸šæ–‡æ¡£</li>
<li><strong>é¢†åŸŸçŸ¥è¯†å¢å¼º</strong>ï¼šç»“åˆä¼ä¸šç§æœ‰çŸ¥è¯†åº“</li>
<li><strong>äº‹å®å‡†ç¡®æ€§</strong>ï¼šåŸºäºæ£€ç´¢ç»“æœç”Ÿæˆç­”æ¡ˆ</li>
<li><strong>æ•°æ®å®‰å…¨æ€§</strong>ï¼šæ•æ„Ÿæ•°æ®ä¸ç¦»å¼€ä¼ä¸šç¯å¢ƒ</li>
</ol>
<h2 id="RAGæŠ€æœ¯åŸç†è¯¦è§£"><a href="#RAGæŠ€æœ¯åŸç†è¯¦è§£" class="headerlink" title="RAGæŠ€æœ¯åŸç†è¯¦è§£"></a>RAGæŠ€æœ¯åŸç†è¯¦è§£</h2><h3 id="æ ¸å¿ƒç»„ä»¶è§£æ"><a href="#æ ¸å¿ƒç»„ä»¶è§£æ" class="headerlink" title="æ ¸å¿ƒç»„ä»¶è§£æ"></a>æ ¸å¿ƒç»„ä»¶è§£æ</h3><p>RAGç³»ç»Ÿç”±ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶æ„æˆï¼š</p>
<h4 id="1-æ–‡æ¡£å¤„ç†ç»„ä»¶ï¼ˆDocument-Processingï¼‰"><a href="#1-æ–‡æ¡£å¤„ç†ç»„ä»¶ï¼ˆDocument-Processingï¼‰" class="headerlink" title="1. æ–‡æ¡£å¤„ç†ç»„ä»¶ï¼ˆDocument Processingï¼‰"></a>1. æ–‡æ¡£å¤„ç†ç»„ä»¶ï¼ˆDocument Processingï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ºä»€ä¹ˆéœ€è¦æ–‡æ¡£é¢„å¤„ç†ï¼Ÿ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentProcessor</span> &#123;</span><br><span class="line">    <span class="comment">// 1. æ–‡æœ¬åˆ†å—ï¼šè§£å†³LLMä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶</span></span><br><span class="line">    <span class="comment">// 2. å…ƒæ•°æ®æå–ï¼šæ”¯æŒåŸºäºå±æ€§çš„è¿‡æ»¤æ£€ç´¢</span></span><br><span class="line">    <span class="comment">// 3. è´¨é‡è¿‡æ»¤ï¼šå»é™¤ä½è´¨é‡å†…å®¹</span></span><br><span class="line">    <span class="comment">// 4. æ ¼å¼æ ‡å‡†åŒ–ï¼šç»Ÿä¸€ä¸åŒæ¥æºæ–‡æ¡£æ ¼å¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆè¦åˆ†å—ï¼Ÿ</strong></p>
<ul>
<li><strong>ä¸Šä¸‹æ–‡é™åˆ¶</strong>ï¼šå¤§å¤šæ•°LLMæœ‰æœ€å¤§tokené™åˆ¶ï¼ˆGPT-4ä¸º8192ï¼ŒClaudeä¸º100kï¼‰</li>
<li><strong>æ£€ç´¢ç²¾åº¦</strong>ï¼šå°å—å†…å®¹æ›´å®¹æ˜“æ‰¾åˆ°ç²¾ç¡®åŒ¹é…</li>
<li><strong>è®¡ç®—æ•ˆç‡</strong>ï¼šå‡å°‘å‘é‡åŒ–è®¡ç®—é‡å’Œå­˜å‚¨æˆæœ¬</li>
</ul>
<h4 id="2-å‘é‡æ£€ç´¢ç»„ä»¶ï¼ˆVector-Searchï¼‰"><a href="#2-å‘é‡æ£€ç´¢ç»„ä»¶ï¼ˆVector-Searchï¼‰" class="headerlink" title="2. å‘é‡æ£€ç´¢ç»„ä»¶ï¼ˆVector Searchï¼‰"></a>2. å‘é‡æ£€ç´¢ç»„ä»¶ï¼ˆVector Searchï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ºä»€ä¹ˆä½¿ç”¨å‘é‡æ£€ç´¢è€Œä¸æ˜¯ä¼ ç»Ÿæ£€ç´¢ï¼Ÿ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VectorSearchEngine</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è¯­ä¹‰ç†è§£ï¼šç†è§£æŸ¥è¯¢æ„å›¾è€Œéå…³é”®è¯åŒ¹é…</span></span><br><span class="line">    <span class="comment">// 2. æ¨¡ç³ŠåŒ¹é…ï¼šå¤„ç†åŒä¹‰è¯ã€å¤šä¹‰è¯é—®é¢˜</span></span><br><span class="line">    <span class="comment">// 3. è·¨è¯­è¨€æ”¯æŒï¼šæ”¯æŒå¤šè¯­è¨€å†…å®¹æ£€ç´¢</span></span><br><span class="line">    <span class="comment">// 4. å®æ—¶æ›´æ–°ï¼šæ”¯æŒåŠ¨æ€æ·»åŠ æ–°å†…å®¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å‘é‡æ£€ç´¢ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>è¯­ä¹‰åŒ¹é…</strong>ï¼šä¼ ç»ŸBM25åªèƒ½åšå…³é”®è¯åŒ¹é…ï¼Œå‘é‡æ£€ç´¢èƒ½ç†è§£è¯­ä¹‰</li>
<li><strong>æ‰©å±•æ€§å¥½</strong>ï¼šæ”¯æŒæµ·é‡æ•°æ®çš„å®æ—¶æ£€ç´¢</li>
<li><strong>å¤šæ¨¡æ€æ”¯æŒ</strong>ï¼šä¸ä»…æ”¯æŒæ–‡æœ¬ï¼Œè¿˜æ”¯æŒå›¾åƒã€éŸ³é¢‘ç­‰</li>
</ul>
<h4 id="3-ç”Ÿæˆå¢å¼ºç»„ä»¶ï¼ˆGeneration-Augmentationï¼‰"><a href="#3-ç”Ÿæˆå¢å¼ºç»„ä»¶ï¼ˆGeneration-Augmentationï¼‰" class="headerlink" title="3. ç”Ÿæˆå¢å¼ºç»„ä»¶ï¼ˆGeneration Augmentationï¼‰"></a>3. ç”Ÿæˆå¢å¼ºç»„ä»¶ï¼ˆGeneration Augmentationï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ºä»€ä¹ˆéœ€è¦æ£€ç´¢å¢å¼ºç”Ÿæˆï¼Ÿ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnhancedGenerator</span> &#123;</span><br><span class="line">    <span class="comment">// 1. ä¸Šä¸‹æ–‡å¢å¼ºï¼šæä¾›ç›¸å…³èƒŒæ™¯ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">// 2. äº‹å®éªŒè¯ï¼šåŸºäºæ£€ç´¢ç»“æœç”Ÿæˆç­”æ¡ˆ</span></span><br><span class="line">    <span class="comment">// 3. å¼•ç”¨æ”¯æŒï¼šæä¾›ç­”æ¡ˆæ¥æºä¾æ®</span></span><br><span class="line">    <span class="comment">// 4. å‡å°‘å¹»è§‰ï¼šé™ä½æ¨¡å‹èƒ¡è¯´å…«é“çš„æ¦‚ç‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æŠ€æœ¯é€‰å‹åˆ†æ"><a href="#æŠ€æœ¯é€‰å‹åˆ†æ" class="headerlink" title="æŠ€æœ¯é€‰å‹åˆ†æ"></a>æŠ€æœ¯é€‰å‹åˆ†æ</h3><h4 id="ä¸ºä»€ä¹ˆé€‰æ‹©Milvusï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©Milvusï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹©Milvusï¼Ÿ"></a>ä¸ºä»€ä¹ˆé€‰æ‹©Milvusï¼Ÿ</h4><p>åœ¨ä¼—å¤šå‘é‡æ•°æ®åº“ä¸­é€‰æ‹©Milvusçš„åŸå› ï¼š</p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>Milvus</th>
<th>Pinecone</th>
<th>Weaviate</th>
<th>Qdrant</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å¼€æºç¨‹åº¦</strong></td>
<td>å®Œå…¨å¼€æº</td>
<td>é—­æºSaaS</td>
<td>å¼€æº</td>
<td>å¼€æº</td>
</tr>
<tr>
<td><strong>éƒ¨ç½²æ–¹å¼</strong></td>
<td>è‡ªæ‰˜ç®¡</td>
<td>äº‘æœåŠ¡</td>
<td>è‡ªæ‰˜ç®¡</td>
<td>è‡ªæ‰˜ç®¡</td>
</tr>
<tr>
<td><strong>æ‰©å±•æ€§</strong></td>
<td>æ°´å¹³æ‰©å±•</td>
<td>æœ‰é™</td>
<td>æ°´å¹³æ‰©å±•</td>
<td>æ°´å¹³æ‰©å±•</td>
</tr>
<tr>
<td><strong>ä¼ä¸šæ”¯æŒ</strong></td>
<td>å•†ä¸šç‰ˆå¯ç”¨</td>
<td>ä¼ä¸šç‰ˆ</td>
<td>å•†ä¸šç‰ˆ</td>
<td>ä¼ä¸šç‰ˆ</td>
</tr>
<tr>
<td><strong>Javaæ”¯æŒ</strong></td>
<td>åŸç”ŸSDK</td>
<td>REST API</td>
<td>REST API</td>
<td>REST API</td>
</tr>
<tr>
<td><strong>æˆæœ¬æ§åˆ¶</strong></td>
<td>å®Œå…¨å¯æ§</td>
<td>æŒ‰é‡è®¡è´¹</td>
<td>å¯æ§</td>
<td>å¯æ§</td>
</tr>
</tbody></table>
<p><strong>é€‰æ‹©Milvusçš„å…³é”®åŸå› </strong>ï¼š</p>
<ol>
<li><strong>å®Œå…¨å¼€æº</strong>ï¼šä¼ä¸šå¯ä»¥å®Œå…¨æ§åˆ¶æ•°æ®å’Œä»£ç </li>
<li><strong>åŸç”ŸJava SDK</strong>ï¼šæ€§èƒ½æ›´å¥½ï¼Œé›†æˆæ›´ç®€å•</li>
<li><strong>æ°´å¹³æ‰©å±•</strong>ï¼šæ”¯æŒPBçº§æ•°æ®å­˜å‚¨</li>
<li><strong>ä¼ä¸šçº§ç‰¹æ€§</strong>ï¼šæä¾›å•†ä¸šæ”¯æŒå’Œä¼ä¸šç‰ˆ</li>
<li><strong>æ´»è·ƒç¤¾åŒº</strong>ï¼šæœ‰å®Œå–„çš„æ–‡æ¡£å’Œç¤¾åŒºæ”¯æŒ</li>
</ol>
<h2 id="ç³»ç»Ÿæ¶æ„è®¾è®¡"><a href="#ç³»ç»Ÿæ¶æ„è®¾è®¡" class="headerlink" title="ç³»ç»Ÿæ¶æ„è®¾è®¡"></a>ç³»ç»Ÿæ¶æ„è®¾è®¡</h2><h3 id="æ•´ä½“æ¶æ„å›¾"><a href="#æ•´ä½“æ¶æ„å›¾" class="headerlink" title="æ•´ä½“æ¶æ„å›¾"></a>æ•´ä½“æ¶æ„å›¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   ä¼ä¸šæ–‡æ¡£      â”‚    â”‚   æ–‡æ¡£å¤„ç†      â”‚    â”‚   å‘é‡æ£€ç´¢      â”‚</span><br><span class="line">â”‚   (PDF, Word,   â”‚â”€â”€â”€â–¶â”‚   (åˆ†å—å‘é‡åŒ–)  â”‚â”€â”€â”€â–¶â”‚   (Milvus)     â”‚</span><br><span class="line">â”‚    Markdown)    â”‚    â”‚                 â”‚    â”‚                 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">         â”‚                        â”‚                        â”‚</span><br><span class="line">         â–¼                        â–¼                        â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   ç”¨æˆ·æŸ¥è¯¢      â”‚    â”‚   æ£€ç´¢å¢å¼º      â”‚    â”‚   ç­”æ¡ˆç”Ÿæˆ      â”‚</span><br><span class="line">â”‚   (è‡ªç„¶è¯­è¨€)    â”‚â”€â”€â”€â–¶â”‚   (Reranking)   â”‚â”€â”€â”€â–¶â”‚   (LLM)        â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<h3 id="å„æ¨¡å—èŒè´£åˆ†æ"><a href="#å„æ¨¡å—èŒè´£åˆ†æ" class="headerlink" title="å„æ¨¡å—èŒè´£åˆ†æ"></a>å„æ¨¡å—èŒè´£åˆ†æ</h3><h4 id="1-æ•°æ®æ¥å…¥å±‚"><a href="#1-æ•°æ®æ¥å…¥å±‚" class="headerlink" title="1. æ•°æ®æ¥å…¥å±‚"></a>1. æ•°æ®æ¥å…¥å±‚</h4><p><strong>ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®æ¥å…¥å±‚ï¼Ÿ</strong></p>
<ul>
<li><strong>ç»Ÿä¸€æ¥å£</strong>ï¼šå±è”½ä¸åŒæ•°æ®æºçš„å·®å¼‚</li>
<li><strong>æ•°æ®è´¨é‡</strong>ï¼šè¿‡æ»¤å’Œæ¸…æ´—åŸå§‹æ•°æ®</li>
<li><strong>æ ¼å¼è½¬æ¢</strong>ï¼šç»Ÿä¸€è½¬æ¢ä¸ºç³»ç»Ÿå¯å¤„ç†çš„æ ¼å¼</li>
<li><strong>æƒé™æ§åˆ¶</strong>ï¼šç¡®ä¿æ•°æ®è®¿é—®çš„å®‰å…¨æ€§</li>
</ul>
<h4 id="2-æ–‡æ¡£å¤„ç†å±‚"><a href="#2-æ–‡æ¡£å¤„ç†å±‚" class="headerlink" title="2. æ–‡æ¡£å¤„ç†å±‚"></a>2. æ–‡æ¡£å¤„ç†å±‚</h4><p><strong>æ–‡æ¡£å¤„ç†çš„æ ¸å¿ƒç›®æ ‡</strong>ï¼š</p>
<ul>
<li><strong>åˆ†å—ç­–ç•¥</strong>ï¼šç¡®å®šæœ€ä½³çš„æ–‡æœ¬åˆ†å—å¤§å°</li>
<li><strong>å…ƒæ•°æ®æå–</strong>ï¼šæå–æ–‡æ¡£çš„å…³é”®ä¿¡æ¯</li>
<li><strong>è´¨é‡è¯„ä¼°</strong>ï¼šè¿‡æ»¤ä½è´¨é‡å†…å®¹</li>
<li><strong>å‘é‡åŒ–å‡†å¤‡</strong>ï¼šä¸ºåç»­å‘é‡åŒ–åšå‡†å¤‡</li>
</ul>
<h4 id="3-å‘é‡æ£€ç´¢å±‚"><a href="#3-å‘é‡æ£€ç´¢å±‚" class="headerlink" title="3. å‘é‡æ£€ç´¢å±‚"></a>3. å‘é‡æ£€ç´¢å±‚</h4><p><strong>Milvusé›†ç¾¤çš„ä½œç”¨</strong>ï¼š</p>
<ul>
<li><strong>é«˜æ€§èƒ½æ£€ç´¢</strong>ï¼šæ”¯æŒæ¯«ç§’çº§å‘é‡æ£€ç´¢</li>
<li><strong>æ°´å¹³æ‰©å±•</strong>ï¼šæ”¯æŒæµ·é‡æ•°æ®å­˜å‚¨</li>
<li><strong>å¤šç´¢å¼•æ”¯æŒ</strong>ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©æœ€ä½³ç´¢å¼•</li>
<li><strong>åˆ†å¸ƒå¼éƒ¨ç½²</strong>ï¼šä¿è¯é«˜å¯ç”¨æ€§å’Œæ‰©å±•æ€§</li>
</ul>
<h4 id="4-ç”Ÿæˆå¢å¼ºå±‚"><a href="#4-ç”Ÿæˆå¢å¼ºå±‚" class="headerlink" title="4. ç”Ÿæˆå¢å¼ºå±‚"></a>4. ç”Ÿæˆå¢å¼ºå±‚</h4><p><strong>æ£€ç´¢ç»“æœå¢å¼ºçš„å¿…è¦æ€§</strong>ï¼š</p>
<ul>
<li><strong>ç›¸å…³æ€§æ’åº</strong>ï¼šç¡®ä¿æœ€é‡è¦çš„ä¿¡æ¯ä¼˜å…ˆ</li>
<li><strong>ä¸Šä¸‹æ–‡æ•´åˆ</strong>ï¼šæä¾›å®Œæ•´çš„èƒŒæ™¯ä¿¡æ¯</li>
<li><strong>ç­”æ¡ˆéªŒè¯</strong>ï¼šç¡®ä¿ç­”æ¡ˆçš„å‡†ç¡®æ€§</li>
<li><strong>å¼•ç”¨æ ‡æ³¨</strong>ï¼šæä¾›ç­”æ¡ˆæ¥æºä¾æ®</li>
</ul>
<h2 id="ç¯å¢ƒå‡†å¤‡ä¸éƒ¨ç½²"><a href="#ç¯å¢ƒå‡†å¤‡ä¸éƒ¨ç½²" class="headerlink" title="ç¯å¢ƒå‡†å¤‡ä¸éƒ¨ç½²"></a>ç¯å¢ƒå‡†å¤‡ä¸éƒ¨ç½²</h2><h3 id="å¼€å‘ç¯å¢ƒé…ç½®"><a href="#å¼€å‘ç¯å¢ƒé…ç½®" class="headerlink" title="å¼€å‘ç¯å¢ƒé…ç½®"></a>å¼€å‘ç¯å¢ƒé…ç½®</h3><h4 id="1-Javaç¯å¢ƒè¦æ±‚"><a href="#1-Javaç¯å¢ƒè¦æ±‚" class="headerlink" title="1. Javaç¯å¢ƒè¦æ±‚"></a>1. Javaç¯å¢ƒè¦æ±‚</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä¸ºä»€ä¹ˆé€‰æ‹©Java 17ï¼Ÿ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1. LTSç‰ˆæœ¬ï¼Œé•¿æœŸæ”¯æŒ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2. æ€§èƒ½ä¼˜åŒ–ï¼Œæ–°ç‰¹æ€§æ”¯æŒ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3. ä¼ä¸šçº§åº”ç”¨çš„æœ€ä½³é€‰æ‹© --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-æ ¸å¿ƒä¾èµ–é…ç½®"><a href="#2-æ ¸å¿ƒä¾èµ–é…ç½®" class="headerlink" title="2. æ ¸å¿ƒä¾èµ–é…ç½®"></a>2. æ ¸å¿ƒä¾èµ–é…ç½®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot æ ¸å¿ƒ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- Milvus Java SDK --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.milvus<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>milvus-sdk-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- æ–‡æ¡£å¤„ç† --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tika<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tika-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- å‘é‡åŒ–æ¨¡å‹ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.knuddels<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jtokkit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- LLMé›†æˆ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.theokanning.openai-gpt3-java<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.18.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Milvuséƒ¨ç½²æ–¹æ¡ˆ"><a href="#Milvuséƒ¨ç½²æ–¹æ¡ˆ" class="headerlink" title="Milvuséƒ¨ç½²æ–¹æ¡ˆ"></a>Milvuséƒ¨ç½²æ–¹æ¡ˆ</h3><h4 id="1-å•æœºéƒ¨ç½²ï¼ˆå¼€å‘ç¯å¢ƒï¼‰"><a href="#1-å•æœºéƒ¨ç½²ï¼ˆå¼€å‘ç¯å¢ƒï¼‰" class="headerlink" title="1. å•æœºéƒ¨ç½²ï¼ˆå¼€å‘ç¯å¢ƒï¼‰"></a>1. å•æœºéƒ¨ç½²ï¼ˆå¼€å‘ç¯å¢ƒï¼‰</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">milvus-standalone:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">milvusdb/milvus:v2.3.6</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">milvus-standalone</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;19530:19530&quot;</span>  <span class="comment"># Milvusç«¯å£</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9091:9091&quot;</span>    <span class="comment"># Web UIç«¯å£</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./milvus:/var/lib/milvus</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;milvus&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;standalone&quot;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="2-é›†ç¾¤éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰"><a href="#2-é›†ç¾¤éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰" class="headerlink" title="2. é›†ç¾¤éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰"></a>2. é›†ç¾¤éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">milvus-etcd:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">quay.io/coreos/etcd:v3.5.5</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_AUTO_COMPACTION_MODE=revision</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_AUTO_COMPACTION_RETENTION=1000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_QUOTA_BACKEND_BYTES=4294967296</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_SNAPSHOT_COUNT=50000</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">milvus-minio:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">minio/minio:RELEASE.2023-03-20T20-16-18Z</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MINIO_ACCESS_KEY:</span> <span class="string">minioadmin</span></span><br><span class="line">      <span class="attr">MINIO_SECRET_KEY:</span> <span class="string">minioadmin</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">minio</span> <span class="string">server</span> <span class="string">/minio_data</span> <span class="string">--console-address</span> <span class="string">:9001</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">milvus-datacoord:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">milvusdb/milvus:v2.3.6</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;milvus&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;datacoord&quot;</span>]</span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">milvus-etcd</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">milvus-minio</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">milvus-datanode:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">milvusdb/milvus:v2.3.6</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;milvus&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;datanode&quot;</span>]</span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">milvus-datacoord</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">milvus-querycoord:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">milvusdb/milvus:v2.3.6</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;milvus&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;querycoord&quot;</span>]</span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">milvus-etcd</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">milvus-querynode:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">milvusdb/milvus:v2.3.6</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;milvus&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;querynode&quot;</span>]</span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">milvus-querycoord</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">milvus-indexcoord:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">milvusdb/milvus:v2.3.6</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;milvus&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;indexcoord&quot;</span>]</span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">milvus-etcd</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">milvus-indexnode:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">milvusdb/milvus:v2.3.6</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;milvus&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;indexnode&quot;</span>]</span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">milvus-indexcoord</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">milvus-proxy:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">milvusdb/milvus:v2.3.6</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;19530:19530&quot;</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;milvus&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;proxy&quot;</span>]</span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">milvus-querycoord</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">milvus-datacoord</span></span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆé‡‡ç”¨é›†ç¾¤éƒ¨ç½²ï¼Ÿ</strong></p>
<ol>
<li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šå•ç‚¹æ•…éšœä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿ</li>
<li><strong>æ°´å¹³æ‰©å±•</strong>ï¼šå¯ä»¥æ ¹æ®æ•°æ®é‡åŠ¨æ€æ‰©å±•èŠ‚ç‚¹</li>
<li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šåˆ†æ•£è¯»å†™å‹åŠ›ï¼Œæé«˜å¹¶å‘æ€§èƒ½</li>
<li><strong>æ•°æ®å®‰å…¨</strong>ï¼šå¤šå‰¯æœ¬å­˜å‚¨ï¼Œä¿è¯æ•°æ®ä¸ä¸¢å¤±</li>
</ol>
<h2 id="æ ¸å¿ƒå®ç°ä»£ç "><a href="#æ ¸å¿ƒå®ç°ä»£ç " class="headerlink" title="æ ¸å¿ƒå®ç°ä»£ç "></a>æ ¸å¿ƒå®ç°ä»£ç </h2><h3 id="1-é…ç½®æ–‡ä»¶è®¾è®¡"><a href="#1-é…ç½®æ–‡ä»¶è®¾è®¡" class="headerlink" title="1. é…ç½®æ–‡ä»¶è®¾è®¡"></a>1. é…ç½®æ–‡ä»¶è®¾è®¡</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">milvus:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">19530</span></span><br><span class="line">  <span class="attr">collection:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">enterprise_docs</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">&quot;ä¼ä¸šæ–‡æ¡£çŸ¥è¯†åº“&quot;</span></span><br><span class="line">    <span class="attr">vector:</span></span><br><span class="line">      <span class="attr">dimension:</span> <span class="number">1536</span>  <span class="comment"># OpenAI text-embedding-ada-002ç»´åº¦</span></span><br><span class="line">      <span class="attr">metric-type:</span> <span class="string">COSINE</span>  <span class="comment"># ç›¸ä¼¼åº¦åº¦é‡æ–¹å¼</span></span><br><span class="line">      <span class="attr">index-type:</span> <span class="string">IVF_FLAT</span>  <span class="comment"># ç´¢å¼•ç±»å‹</span></span><br><span class="line">      <span class="attr">index-params:</span></span><br><span class="line">        <span class="attr">nlist:</span> <span class="number">128</span>  <span class="comment"># èšç±»ä¸­å¿ƒæ•°é‡</span></span><br><span class="line"></span><br><span class="line"><span class="attr">openai:</span></span><br><span class="line">  <span class="attr">api-key:</span> <span class="string">$&#123;OPENAI_API_KEY&#125;</span></span><br><span class="line">  <span class="attr">model:</span> <span class="string">gpt-3.5-turbo</span></span><br><span class="line">  <span class="attr">embedding-model:</span> <span class="string">text-embedding-ada-002</span></span><br><span class="line">  <span class="attr">max-tokens:</span> <span class="number">4000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">document:</span></span><br><span class="line">  <span class="attr">chunk:</span></span><br><span class="line">    <span class="attr">size:</span> <span class="number">1000</span>  <span class="comment"># åˆ†å—å¤§å°</span></span><br><span class="line">    <span class="attr">overlap:</span> <span class="number">200</span>  <span class="comment"># åˆ†å—é‡å </span></span><br><span class="line">  <span class="attr">supported-types:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">pdf</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docx</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">txt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">md</span></span><br></pre></td></tr></table></figure>

<h3 id="2-æ–‡æ¡£å¤„ç†æœåŠ¡"><a href="#2-æ–‡æ¡£å¤„ç†æœåŠ¡" class="headerlink" title="2. æ–‡æ¡£å¤„ç†æœåŠ¡"></a>2. æ–‡æ¡£å¤„ç†æœåŠ¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentProcessingService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MilvusService milvusService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmbeddingService embeddingService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æ¡£å¤„ç†æ ¸å¿ƒæµç¨‹</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå®Œæ•´çš„å¤„ç†æµç¨‹ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. æ–‡æ¡£è§£æï¼šå°†å„ç§æ ¼å¼è½¬æ¢ä¸ºçº¯æ–‡æœ¬</span></span><br><span class="line"><span class="comment">     * 2. æ–‡æœ¬åˆ†å—ï¼šè§£å†³LLMä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶</span></span><br><span class="line"><span class="comment">     * 3. å‘é‡åŒ–ï¼šè½¬æ¢ä¸ºå‘é‡è¡¨ç¤º</span></span><br><span class="line"><span class="comment">     * 4. å­˜å‚¨ï¼šä¿å­˜åˆ°å‘é‡æ•°æ®åº“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processDocument</span><span class="params">(MultipartFile file, String category, String tags)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. æ–‡æ¡£è§£æ</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> parseDocument(file);</span><br><span class="line">            log.info(<span class="string">&quot;æ–‡æ¡£è§£æå®Œæˆï¼Œå†…å®¹é•¿åº¦: &#123;&#125;&quot;</span>, content.length());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. æ–‡æœ¬åˆ†å—</span></span><br><span class="line">            List&lt;DocumentChunk&gt; chunks = splitDocument(content, category, tags);</span><br><span class="line">            log.info(<span class="string">&quot;æ–‡æœ¬åˆ†å—å®Œæˆï¼Œåˆ†å—æ•°é‡: &#123;&#125;&quot;</span>, chunks.size());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. æ‰¹é‡å‘é‡åŒ–</span></span><br><span class="line">            List&lt;<span class="type">float</span>[]&gt; vectors = embeddingService.embedTexts(</span><br><span class="line">                chunks.stream()</span><br><span class="line">                    .map(DocumentChunk::getContent)</span><br><span class="line">                    .collect(Collectors.toList())</span><br><span class="line">            );</span><br><span class="line">            log.info(<span class="string">&quot;å‘é‡åŒ–å®Œæˆï¼Œå‘é‡ç»´åº¦: &#123;&#125;&quot;</span>, vectors.get(<span class="number">0</span>).length);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. å­˜å‚¨åˆ°Milvus</span></span><br><span class="line">            milvusService.insertDocuments(chunks, vectors);</span><br><span class="line">            log.info(<span class="string">&quot;æ–‡æ¡£å­˜å‚¨å®Œæˆï¼Œæ€»è®¡: &#123;&#125; ä¸ªåˆ†å—&quot;</span>, chunks.size());</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ–‡æ¡£å¤„ç†å¤±è´¥: &#123;&#125;&quot;</span>, file.getOriginalFilename(), e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ–‡æ¡£å¤„ç†å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æ¡£è§£æ - æ”¯æŒå¤šç§æ ¼å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">parseDocument</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">extension</span> <span class="operator">=</span> fileName.substring(fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>).toLowerCase();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> file.getInputStream()) &#123;</span><br><span class="line">            <span class="type">AutoDetectParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoDetectParser</span>();</span><br><span class="line">            <span class="type">BodyContentHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BodyContentHandler</span>(-<span class="number">1</span>); <span class="comment">// ä¸é™åˆ¶å†…å®¹å¤§å°</span></span><br><span class="line">            <span class="type">Metadata</span> <span class="variable">metadata</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Metadata</span>();</span><br><span class="line">            <span class="type">ParseContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParseContext</span>();</span><br><span class="line">            </span><br><span class="line">            parser.parse(input, handler, metadata, context);</span><br><span class="line">            <span class="keyword">return</span> handler.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ™ºèƒ½æ–‡æœ¬åˆ†å—ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦æ™ºèƒ½åˆ†å—ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. ä¿æŒè¯­ä¹‰å®Œæ•´æ€§ï¼šé¿å…åœ¨å¥å­ä¸­é—´æˆªæ–­</span></span><br><span class="line"><span class="comment">     * 2. æ§åˆ¶åˆ†å—å¤§å°ï¼šç¡®ä¿æ¯ä¸ªåˆ†å—åœ¨åˆç†èŒƒå›´å†…</span></span><br><span class="line"><span class="comment">     * 3. é‡å ç­–ç•¥ï¼šä¿æŒä¸Šä¸‹æ–‡è¿è´¯æ€§</span></span><br><span class="line"><span class="comment">     * 4. å…ƒæ•°æ®ä¿ç•™ï¼šä¿ç•™åŸå§‹æ–‡æ¡£ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;DocumentChunk&gt; <span class="title function_">splitDocument</span><span class="params">(String content, String category, String tags)</span> &#123;</span><br><span class="line">        List&lt;DocumentChunk&gt; chunks = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æŒ‰æ®µè½åˆ†å‰²</span></span><br><span class="line">        String[] paragraphs = content.split(<span class="string">&quot;\\n\\s*\\n&quot;</span>);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">currentChunk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (String paragraph : paragraphs) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ·»åŠ å½“å‰æ®µè½ä¼šè¶…è¿‡é™åˆ¶ï¼Œå¼€å§‹æ–°åˆ†å—</span></span><br><span class="line">            <span class="keyword">if</span> (currentChunk.length() + paragraph.length() &gt; </span><br><span class="line">                documentConfig.getChunkSize() - documentConfig.getOverlap()) &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (currentChunk.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    chunks.add(createDocumentChunk(currentChunk.toString(), </span><br><span class="line">                                                 category, tags, chunks.size()));</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// ä¿ç•™é‡å å†…å®¹</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">overlapContent</span> <span class="operator">=</span> getOverlapContent(currentChunk.toString());</span><br><span class="line">                    currentChunk = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(overlapContent);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (currentChunk.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                currentChunk.append(<span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            currentChunk.append(paragraph);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¤„ç†æœ€åä¸€ä¸ªåˆ†å—</span></span><br><span class="line">        <span class="keyword">if</span> (currentChunk.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            chunks.add(createDocumentChunk(currentChunk.toString(), </span><br><span class="line">                                         category, tags, chunks.size()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chunks;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–é‡å å†…å®¹ - ä¿æŒä¸Šä¸‹æ–‡è¿è´¯æ€§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getOverlapContent</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        String[] sentences = content.split(<span class="string">&quot;(?&lt;=[.!?])\\s+&quot;</span>);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">overlap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">overlapSize</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä»åå¾€å‰æ·»åŠ å¥å­ï¼Œç›´åˆ°è¾¾åˆ°é‡å å¤§å°</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> sentences.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (overlapSize + sentences[i].length() &gt; documentConfig.getOverlap()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            overlap.insert(<span class="number">0</span>, sentences[i] + <span class="string">&quot; &quot;</span>);</span><br><span class="line">            overlapSize += sentences[i].length();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> overlap.toString().trim();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºæ–‡æ¡£åˆ†å—å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> DocumentChunk <span class="title function_">createDocumentChunk</span><span class="params">(String content, String category, </span></span><br><span class="line"><span class="params">                                            String tags, <span class="type">int</span> chunkIndex)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DocumentChunk.builder()</span><br><span class="line">                .id(UUID.randomUUID().toString())</span><br><span class="line">                .content(content)</span><br><span class="line">                .category(category)</span><br><span class="line">                .tags(tags)</span><br><span class="line">                .chunkIndex(chunkIndex)</span><br><span class="line">                .createTime(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-MilvusæœåŠ¡å°è£…"><a href="#3-MilvusæœåŠ¡å°è£…" class="headerlink" title="3. MilvusæœåŠ¡å°è£…"></a>3. MilvusæœåŠ¡å°è£…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MilvusService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MilvusClient milvusClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MilvusConfig milvusConfig;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–é›†åˆ</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦é›†åˆåˆå§‹åŒ–ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. å®šä¹‰æ•°æ®ç»“æ„ï¼šæŒ‡å®šå‘é‡ç»´åº¦å’Œå­—æ®µç±»å‹</span></span><br><span class="line"><span class="comment">     * 2. åˆ›å»ºç´¢å¼•ï¼šä¸ºå‘é‡å­—æ®µåˆ›å»ºåˆé€‚çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * 3. è®¾ç½®å‚æ•°ï¼šé…ç½®é›†åˆçš„å„ç§å‚æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initCollection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥é›†åˆæ˜¯å¦å­˜åœ¨</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> milvusClient.hasCollection(</span><br><span class="line">                HasCollectionParam.newBuilder()</span><br><span class="line">                    .withCollectionName(milvusConfig.getCollectionName())</span><br><span class="line">                    .build()</span><br><span class="line">            ).getData();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!exists) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;åˆ›å»ºMilvusé›†åˆ: &#123;&#125;&quot;</span>, milvusConfig.getCollectionName());</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// åˆ›å»ºé›†åˆ</span></span><br><span class="line">                milvusClient.createCollection(</span><br><span class="line">                    CreateCollectionParam.newBuilder()</span><br><span class="line">                        .withCollectionName(milvusConfig.getCollectionName())</span><br><span class="line">                        .withDescription(milvusConfig.getDescription())</span><br><span class="line">                        .addFieldType(FieldType.newBuilder()</span><br><span class="line">                            .withName(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">                            .withDataType(DataType.VarChar)</span><br><span class="line">                            .withMaxLength(<span class="number">64</span>)</span><br><span class="line">                            .withPrimaryKey(<span class="literal">true</span>)</span><br><span class="line">                            .withAutoID(<span class="literal">false</span>)</span><br><span class="line">                            .build())</span><br><span class="line">                        .addFieldType(FieldType.newBuilder()</span><br><span class="line">                            .withName(<span class="string">&quot;vector&quot;</span>)</span><br><span class="line">                            .withDataType(DataType.FloatVector)</span><br><span class="line">                            .withDimension(milvusConfig.getVectorDimension())</span><br><span class="line">                            .build())</span><br><span class="line">                        .addFieldType(FieldType.newBuilder()</span><br><span class="line">                            .withName(<span class="string">&quot;content&quot;</span>)</span><br><span class="line">                            .withDataType(DataType.VarChar)</span><br><span class="line">                            .withMaxLength(<span class="number">65535</span>)</span><br><span class="line">                            .build())</span><br><span class="line">                        .addFieldType(FieldType.newBuilder()</span><br><span class="line">                            .withName(<span class="string">&quot;category&quot;</span>)</span><br><span class="line">                            .withDataType(DataType.VarChar)</span><br><span class="line">                            .withMaxLength(<span class="number">100</span>)</span><br><span class="line">                            .build())</span><br><span class="line">                        .addFieldType(FieldType.newBuilder()</span><br><span class="line">                            .withName(<span class="string">&quot;tags&quot;</span>)</span><br><span class="line">                            .withDataType(DataType.VarChar)</span><br><span class="line">                            .withMaxLength(<span class="number">500</span>)</span><br><span class="line">                            .build())</span><br><span class="line">                        .addFieldType(FieldType.newBuilder()</span><br><span class="line">                            .withName(<span class="string">&quot;chunk_index&quot;</span>)</span><br><span class="line">                            .withDataType(DataType.Int64)</span><br><span class="line">                            .build())</span><br><span class="line">                        .addFieldType(FieldType.newBuilder()</span><br><span class="line">                            .withName(<span class="string">&quot;create_time&quot;</span>)</span><br><span class="line">                            .withDataType(DataType.Int64)</span><br><span class="line">                            .build())</span><br><span class="line">                        .build()</span><br><span class="line">                );</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// åˆ›å»ºç´¢å¼•</span></span><br><span class="line">                createIndex();</span><br><span class="line">                </span><br><span class="line">                log.info(<span class="string">&quot;Milvusé›†åˆåˆ›å»ºæˆåŠŸ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Milvusé›†åˆåˆå§‹åŒ–å¤±è´¥&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Milvusé›†åˆåˆå§‹åŒ–å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºå‘é‡ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦åˆé€‚çš„ç´¢å¼•ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. æ£€ç´¢æ€§èƒ½ï¼šç´¢å¼•å¯ä»¥å¤§å¤§æå‡æ£€ç´¢é€Ÿåº¦</span></span><br><span class="line"><span class="comment">     * 2. å†…å­˜æ•ˆç‡ï¼šå‡å°‘å†…å­˜ä½¿ç”¨</span></span><br><span class="line"><span class="comment">     * 3. å‡†ç¡®æ€§ï¼šä¸åŒç´¢å¼•ç±»å‹å¯¹å‡†ç¡®æ€§å½±å“ä¸åŒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">createIndex</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä¸ºå‘é‡å­—æ®µåˆ›å»ºIVF_FLATç´¢å¼•</span></span><br><span class="line">            <span class="type">CreateIndexParam</span> <span class="variable">indexParam</span> <span class="operator">=</span> CreateIndexParam.newBuilder()</span><br><span class="line">                .withCollectionName(milvusConfig.getCollectionName())</span><br><span class="line">                .withFieldName(<span class="string">&quot;vector&quot;</span>)</span><br><span class="line">                .withIndexType(IndexType.IVF_FLAT)</span><br><span class="line">                .withMetricType(MetricType.COSINE)</span><br><span class="line">                .withExtraParam(<span class="string">&quot;&#123;\&quot;nlist\&quot;: 128&#125;&quot;</span>)</span><br><span class="line">                .withSyncMode(Boolean.FALSE)</span><br><span class="line">                .build();</span><br><span class="line">            </span><br><span class="line">            milvusClient.createIndex(indexParam);</span><br><span class="line">            log.info(<span class="string">&quot;å‘é‡ç´¢å¼•åˆ›å»ºæˆåŠŸ&quot;</span>);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å‘é‡ç´¢å¼•åˆ›å»ºå¤±è´¥&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å‘é‡ç´¢å¼•åˆ›å»ºå¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ’å…¥æ–‡æ¡£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertDocuments</span><span class="params">(List&lt;DocumentChunk&gt; chunks, List&lt;<span class="type">float</span>[]&gt; vectors)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;InsertParam.Field&gt; fields = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// IDå­—æ®µ</span></span><br><span class="line">            List&lt;String&gt; ids = chunks.stream()</span><br><span class="line">                .map(DocumentChunk::getId)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">            fields.add(<span class="keyword">new</span> <span class="title class_">InsertParam</span>.Field(<span class="string">&quot;id&quot;</span>, ids));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å‘é‡å­—æ®µ</span></span><br><span class="line">            fields.add(<span class="keyword">new</span> <span class="title class_">InsertParam</span>.Field(<span class="string">&quot;vector&quot;</span>, vectors));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å†…å®¹å­—æ®µ</span></span><br><span class="line">            List&lt;String&gt; contents = chunks.stream()</span><br><span class="line">                .map(DocumentChunk::getContent)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">            fields.add(<span class="keyword">new</span> <span class="title class_">InsertParam</span>.Field(<span class="string">&quot;content&quot;</span>, contents));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å…¶ä»–å­—æ®µ...</span></span><br><span class="line">            List&lt;String&gt; categories = chunks.stream()</span><br><span class="line">                .map(DocumentChunk::getCategory)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">            fields.add(<span class="keyword">new</span> <span class="title class_">InsertParam</span>.Field(<span class="string">&quot;category&quot;</span>, categories));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ‰§è¡Œæ’å…¥</span></span><br><span class="line">            <span class="type">InsertParam</span> <span class="variable">insertParam</span> <span class="operator">=</span> InsertParam.newBuilder()</span><br><span class="line">                .withCollectionName(milvusConfig.getCollectionName())</span><br><span class="line">                .withFields(fields)</span><br><span class="line">                .build();</span><br><span class="line">            </span><br><span class="line">            <span class="type">InsertResponse</span> <span class="variable">response</span> <span class="operator">=</span> milvusClient.insert(insertParam);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åˆ·æ–°æ•°æ®åˆ°ç£ç›˜</span></span><br><span class="line">            milvusClient.flush(FlushParam.newBuilder()</span><br><span class="line">                .withCollectionName(milvusConfig.getCollectionName())</span><br><span class="line">                .addFlushCollectionName(milvusConfig.getCollectionName())</span><br><span class="line">                .build());</span><br><span class="line">            </span><br><span class="line">            log.info(<span class="string">&quot;æˆåŠŸæ’å…¥ &#123;&#125; ä¸ªæ–‡æ¡£åˆ†å—&quot;</span>, chunks.size());</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ–‡æ¡£æ’å…¥å¤±è´¥&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ–‡æ¡£æ’å…¥å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é‡æ£€ç´¢</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦å¤šé‡è¿‡æ»¤ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. ç›¸å…³æ€§è¿‡æ»¤ï¼šåŸºäºç›¸ä¼¼åº¦é˜ˆå€¼</span></span><br><span class="line"><span class="comment">     * 2. ç±»åˆ«è¿‡æ»¤ï¼šåŸºäºæ–‡æ¡£ç±»åˆ«</span></span><br><span class="line"><span class="comment">     * 3. æ—¶é—´è¿‡æ»¤ï¼šåŸºäºåˆ›å»ºæ—¶é—´</span></span><br><span class="line"><span class="comment">     * 4. æƒé™è¿‡æ»¤ï¼šåŸºäºç”¨æˆ·æƒé™</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SearchResult&gt; <span class="title function_">search</span><span class="params">(<span class="type">float</span>[] queryVector, <span class="type">int</span> topK, </span></span><br><span class="line"><span class="params">                                   String category, Date startTime)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ„å»ºæœç´¢å‚æ•°</span></span><br><span class="line">            <span class="type">SearchParam</span> <span class="variable">searchParam</span> <span class="operator">=</span> SearchParam.newBuilder()</span><br><span class="line">                .withCollectionName(milvusConfig.getCollectionName())</span><br><span class="line">                .withVectorFieldName(<span class="string">&quot;vector&quot;</span>)</span><br><span class="line">                .withVectors(Collections.singletonList(queryVector))</span><br><span class="line">                .withTopK(topK)</span><br><span class="line">                .withMetricType(MetricType.COSINE)</span><br><span class="line">                .withParams(<span class="string">&quot;&#123;\&quot;nprobe\&quot;: 10&#125;&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ·»åŠ è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> (category != <span class="literal">null</span> || startTime != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">StringBuilder</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (category != <span class="literal">null</span>) &#123;</span><br><span class="line">                    filter.append(<span class="string">&quot;category == \&quot;&quot;</span>).append(category).append(<span class="string">&quot;\&quot;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (startTime != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (filter.length() &gt; <span class="number">0</span>) filter.append(<span class="string">&quot; and &quot;</span>);</span><br><span class="line">                    filter.append(<span class="string">&quot;create_time &gt;= &quot;</span>).append(startTime.getTime());</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                searchParam = searchParam.toBuilder()</span><br><span class="line">                    .withExpr(filter.toString())</span><br><span class="line">                    .build();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ‰§è¡Œæœç´¢</span></span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> milvusClient.search(searchParam);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è§£æç»“æœ</span></span><br><span class="line">            <span class="keyword">return</span> parseSearchResults(response);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å‘é‡æ£€ç´¢å¤±è´¥&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å‘é‡æ£€ç´¢å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£ææœç´¢ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SearchResult&gt; <span class="title function_">parseSearchResults</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">        List&lt;SearchResult&gt; results = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        List&lt;List&lt;SearchResponse.QueryResult&gt;&gt; queryResults = response.getResults();</span><br><span class="line">        <span class="keyword">for</span> (List&lt;SearchResponse.QueryResult&gt; queryResult : queryResults) &#123;</span><br><span class="line">            <span class="keyword">for</span> (SearchResponse.QueryResult result : queryResult) &#123;</span><br><span class="line">                <span class="type">SearchResult</span> <span class="variable">searchResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchResult</span>();</span><br><span class="line">                searchResult.setId(result.getEntity().get(<span class="string">&quot;id&quot;</span>).toString());</span><br><span class="line">                searchResult.setContent(result.getEntity().get(<span class="string">&quot;content&quot;</span>).toString());</span><br><span class="line">                searchResult.setScore(result.getScore());</span><br><span class="line">                searchResult.setCategory(result.getEntity().get(<span class="string">&quot;category&quot;</span>).toString());</span><br><span class="line">                results.add(searchResult);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> results;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-æ£€ç´¢å¢å¼ºç”ŸæˆæœåŠ¡"><a href="#4-æ£€ç´¢å¢å¼ºç”ŸæˆæœåŠ¡" class="headerlink" title="4. æ£€ç´¢å¢å¼ºç”ŸæˆæœåŠ¡"></a>4. æ£€ç´¢å¢å¼ºç”ŸæˆæœåŠ¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RagService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmbeddingService embeddingService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MilvusService milvusService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OpenAiService openAiService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * RAGé—®ç­”æ ¸å¿ƒæµç¨‹</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå®Œæ•´çš„RAGæµç¨‹ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. æŸ¥è¯¢ç†è§£ï¼šå‡†ç¡®ç†è§£ç”¨æˆ·æ„å›¾</span></span><br><span class="line"><span class="comment">     * 2. æ£€ç´¢å¢å¼ºï¼šè·å–ç›¸å…³ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     * 3. ç­”æ¡ˆç”Ÿæˆï¼šåŸºäºæ£€ç´¢ç»“æœç”Ÿæˆç­”æ¡ˆ</span></span><br><span class="line"><span class="comment">     * 4. å¼•ç”¨æ ‡æ³¨ï¼šæä¾›ç­”æ¡ˆæ¥æºä¾æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> RagResponse <span class="title function_">answerQuestion</span><span class="params">(String question, String category, </span></span><br><span class="line"><span class="params">                                    Integer maxResults)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;å¼€å§‹å¤„ç†é—®é¢˜: &#123;&#125;&quot;</span>, question);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 1. é—®é¢˜å‘é‡åŒ–</span></span><br><span class="line">            <span class="type">float</span>[] queryVector = embeddingService.embedText(question);</span><br><span class="line">            log.info(<span class="string">&quot;é—®é¢˜å‘é‡åŒ–å®Œæˆï¼Œå‘é‡ç»´åº¦: &#123;&#125;&quot;</span>, queryVector.length);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. å‘é‡æ£€ç´¢</span></span><br><span class="line">            List&lt;SearchResult&gt; searchResults = milvusService.search(</span><br><span class="line">                queryVector, </span><br><span class="line">                maxResults != <span class="literal">null</span> ? maxResults : <span class="number">5</span>,</span><br><span class="line">                category,</span><br><span class="line">                <span class="literal">null</span> <span class="comment">// å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ—¶é—´è¿‡æ»¤</span></span><br><span class="line">            );</span><br><span class="line">            log.info(<span class="string">&quot;æ£€ç´¢å®Œæˆï¼Œæ‰¾åˆ° &#123;&#125; ä¸ªç›¸å…³æ–‡æ¡£&quot;</span>, searchResults.size());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. ç»“æœé‡æ’åºå’Œè¿‡æ»¤</span></span><br><span class="line">            List&lt;SearchResult&gt; filteredResults = rerankAndFilter(searchResults, question);</span><br><span class="line">            log.info(<span class="string">&quot;é‡æ’åºåå‰©ä½™ &#123;&#125; ä¸ªæ–‡æ¡£&quot;</span>, filteredResults.size());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. æ„å»ºä¸Šä¸‹æ–‡</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">context</span> <span class="operator">=</span> buildContext(filteredResults);</span><br><span class="line">            log.info(<span class="string">&quot;ä¸Šä¸‹æ–‡æ„å»ºå®Œæˆï¼Œé•¿åº¦: &#123;&#125; å­—ç¬¦&quot;</span>, context.length());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5. ç”Ÿæˆç­”æ¡ˆ</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> generateAnswer(question, context);</span><br><span class="line">            log.info(<span class="string">&quot;ç­”æ¡ˆç”Ÿæˆå®Œæˆï¼Œé•¿åº¦: &#123;&#125; å­—ç¬¦&quot;</span>, answer.length());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 6. æ„å»ºå¼•ç”¨</span></span><br><span class="line">            List&lt;Reference&gt; references = buildReferences(filteredResults);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> RagResponse.builder()</span><br><span class="line">                    .question(question)</span><br><span class="line">                    .answer(answer)</span><br><span class="line">                    .references(references)</span><br><span class="line">                    .searchResults(filteredResults)</span><br><span class="line">                    .build();</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;RAGé—®ç­”å¤„ç†å¤±è´¥: &#123;&#125;&quot;</span>, question, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;é—®ç­”å¤„ç†å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»“æœé‡æ’åºå’Œè¿‡æ»¤</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦é‡æ’åºï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. æé«˜ç›¸å…³æ€§ï¼šåŸºäºé—®é¢˜å’Œæ–‡æ¡£çš„ç›¸å…³æ€§é‡æ–°æ’åº</span></span><br><span class="line"><span class="comment">     * 2. è¿‡æ»¤ä½è´¨é‡ï¼šå»é™¤ç›¸ä¼¼åº¦è¿‡ä½çš„ç»“æœ</span></span><br><span class="line"><span class="comment">     * 3. å¤šæ ·æ€§ä¿è¯ï¼šé¿å…è¿”å›è¿‡äºç›¸ä¼¼çš„æ–‡æ¡£</span></span><br><span class="line"><span class="comment">     * 4. é•¿åº¦æ§åˆ¶ï¼šæ§åˆ¶ä¸Šä¸‹æ–‡æ€»é•¿åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SearchResult&gt; <span class="title function_">rerankAndFilter</span><span class="params">(List&lt;SearchResult&gt; results, String question)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æŒ‰ç›¸ä¼¼åº¦é˜ˆå€¼è¿‡æ»¤</span></span><br><span class="line">        results = results.stream()</span><br><span class="line">            .filter(r -&gt; r.getScore() &gt; <span class="number">0.7</span>) <span class="comment">// ç›¸ä¼¼åº¦é˜ˆå€¼</span></span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æŒ‰ç›¸å…³æ€§é‡æ’åºï¼ˆè¿™é‡Œä½¿ç”¨ç®€å•çš„BM25-likeç®—æ³•ï¼‰</span></span><br><span class="line">        results.forEach(result -&gt; &#123;</span><br><span class="line">            <span class="type">double</span> <span class="variable">relevanceScore</span> <span class="operator">=</span> calculateRelevanceScore(question, result.getContent());</span><br><span class="line">            result.setScore(result.getScore() * <span class="number">0.7</span> + relevanceScore * <span class="number">0.3</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æŒ‰æ–°å¾—åˆ†æ’åº</span></span><br><span class="line">        results.sort((a, b) -&gt; Double.compare(b.getScore(), a.getScore()));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. é™åˆ¶æ•°é‡å’Œé•¿åº¦</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">maxLength</span> <span class="operator">=</span> <span class="number">8000</span>; <span class="comment">// ä¸Šä¸‹æ–‡æœ€å¤§é•¿åº¦</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">currentLength</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        List&lt;SearchResult&gt; filtered = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (SearchResult result : results) &#123;</span><br><span class="line">            <span class="keyword">if</span> (currentLength + result.getContent().length() &gt; maxLength) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            filtered.add(result);</span><br><span class="line">            currentLength += result.getContent().length();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> filtered;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¡ç®—ç›¸å…³æ€§å¾—åˆ†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateRelevanceScore</span><span class="params">(String question, String content)</span> &#123;</span><br><span class="line">        <span class="comment">// ç®€å•çš„è¯é¢‘ç»Ÿè®¡</span></span><br><span class="line">        String[] questionWords = question.toLowerCase().split(<span class="string">&quot;\\s+&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">contentLower</span> <span class="operator">=</span> content.toLowerCase();</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">matchCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (String word : questionWords) &#123;</span><br><span class="line">            <span class="keyword">if</span> (contentLower.contains(word)) &#123;</span><br><span class="line">                matchCount++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>) matchCount / questionWords.length;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦ç²¾å¿ƒæ„å»ºä¸Šä¸‹æ–‡ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. é•¿åº¦æ§åˆ¶ï¼šé¿å…è¶…å‡ºLLMä¸Šä¸‹æ–‡é™åˆ¶</span></span><br><span class="line"><span class="comment">     * 2. ä¿¡æ¯å¯†åº¦ï¼šé€‰æ‹©æœ€ç›¸å…³çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * 3. ç»“æ„åŒ–ï¼šä¿æŒæ–‡æ¡£çš„é€»è¾‘ç»“æ„</span></span><br><span class="line"><span class="comment">     * 4. å¼•ç”¨æ ‡è®°ï¼šä¸ºåç»­å¼•ç”¨åšå‡†å¤‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">buildContext</span><span class="params">(List&lt;SearchResult&gt; results)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        context.append(<span class="string">&quot;åŸºäºä»¥ä¸‹ä¼ä¸šæ–‡æ¡£å†…å®¹æ¥å›ç­”é—®é¢˜ï¼š\n\n&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; results.size(); i++) &#123;</span><br><span class="line">            <span class="type">SearchResult</span> <span class="variable">result</span> <span class="operator">=</span> results.get(i);</span><br><span class="line">            context.append(String.format(<span class="string">&quot;[æ–‡æ¡£%d] (ç›¸ä¼¼åº¦: %.3f, ç±»åˆ«: %s)\n&quot;</span>,</span><br><span class="line">                i + <span class="number">1</span>, result.getScore(), result.getCategory()));</span><br><span class="line">            context.append(result.getContent());</span><br><span class="line">            context.append(<span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        context.append(<span class="string">&quot;è¯·åŸºäºä¸Šè¿°æ–‡æ¡£å†…å®¹å‡†ç¡®å›ç­”é—®é¢˜ï¼Œå¦‚æœæ–‡æ¡£ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·æ˜ç¡®è¯´æ˜ã€‚&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> context.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆç­”æ¡ˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateAnswer</span><span class="params">(String question, String context)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(</span><br><span class="line">            <span class="string">&quot;è¯·åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”é—®é¢˜ã€‚è¦æ±‚ï¼š\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;1. ç­”æ¡ˆå¿…é¡»åŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;2. å¦‚æœä¸Šä¸‹æ–‡ä¿¡æ¯ä¸è¶³ä»¥å›ç­”ï¼Œè¯·æ˜ç¡®è¯´æ˜\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;3. ä¿æŒç­”æ¡ˆçš„å‡†ç¡®æ€§å’Œå®¢è§‚æ€§\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;4. é€‚å½“å¼•ç”¨æ–‡æ¡£æ¥æº\n\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š\n%s\n\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;é—®é¢˜ï¼š%s\n\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;ç­”æ¡ˆï¼š&quot;</span>,</span><br><span class="line">            context, question</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> openAiService.generateAnswer(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºå¼•ç”¨åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Reference&gt; <span class="title function_">buildReferences</span><span class="params">(List&lt;SearchResult&gt; results)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> results.stream()</span><br><span class="line">            .map(result -&gt; Reference.builder()</span><br><span class="line">                .documentId(result.getId())</span><br><span class="line">                .content(result.getContent().substring(<span class="number">0</span>, </span><br><span class="line">                    Math.min(<span class="number">200</span>, result.getContent().length())))</span><br><span class="line">                .similarityScore(result.getScore())</span><br><span class="line">                .category(result.getCategory())</span><br><span class="line">                .build())</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-å‘é‡åŒ–æœåŠ¡"><a href="#5-å‘é‡åŒ–æœåŠ¡" class="headerlink" title="5. å‘é‡åŒ–æœåŠ¡"></a>5. å‘é‡åŒ–æœåŠ¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmbeddingService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OpenAiService openAiService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æœ¬å‘é‡åŒ–</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦é«˜è´¨é‡çš„å‘é‡åŒ–ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. è¯­ä¹‰ç†è§£ï¼šå‡†ç¡®æ•æ‰æ–‡æœ¬è¯­ä¹‰ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * 2. ä¸€è‡´æ€§ï¼šç›¸åŒè¯­ä¹‰çš„æ–‡æœ¬åº”è¯¥æœ‰ç›¸ä¼¼çš„å‘é‡</span></span><br><span class="line"><span class="comment">     * 3. ç»´åº¦åˆé€‚ï¼šå¹³è¡¡ç²¾åº¦å’Œè®¡ç®—æ•ˆç‡</span></span><br><span class="line"><span class="comment">     * 4. å¤šè¯­è¨€æ”¯æŒï¼šæ”¯æŒä¼ä¸šå¤šè¯­è¨€ç¯å¢ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span>[] embedText(String text) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ–‡æœ¬é¢„å¤„ç†</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">processedText</span> <span class="operator">=</span> preprocessText(text);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è°ƒç”¨OpenAI Embedding API</span></span><br><span class="line">            <span class="type">EmbeddingResult</span> <span class="variable">result</span> <span class="operator">=</span> openAiService.createEmbedding(processedText);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> convertToFloatArray(result.getData().get(<span class="number">0</span>).getEmbedding());</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ–‡æœ¬å‘é‡åŒ–å¤±è´¥: &#123;&#125;&quot;</span>, text.substring(<span class="number">0</span>, <span class="number">100</span>), e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ–‡æœ¬å‘é‡åŒ–å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡æ–‡æœ¬å‘é‡åŒ–</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦æ‰¹é‡å¤„ç†ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. æé«˜æ•ˆç‡ï¼šå‡å°‘APIè°ƒç”¨æ¬¡æ•°</span></span><br><span class="line"><span class="comment">     * 2. é™ä½æˆæœ¬ï¼šæ‰¹é‡è°ƒç”¨é€šå¸¸æ›´ä¾¿å®œ</span></span><br><span class="line"><span class="comment">     * 3. é”™è¯¯å¤„ç†ï¼šç»Ÿä¸€å¤„ç†æ‰¹é‡é”™è¯¯</span></span><br><span class="line"><span class="comment">     * 4. èµ„æºæ§åˆ¶ï¼šé¿å…çªå‘æµé‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="type">float</span>[]&gt; embedTexts(List&lt;String&gt; texts) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ†æ‰¹å¤„ç†ï¼Œé¿å…å•æ¬¡è¯·æ±‚è¿‡å¤§</span></span><br><span class="line">            List&lt;<span class="type">float</span>[]&gt; allEmbeddings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">10</span>; <span class="comment">// æ ¹æ®APIé™åˆ¶è°ƒæ•´</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; texts.size(); i += batchSize) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">endIndex</span> <span class="operator">=</span> Math.min(i + batchSize, texts.size());</span><br><span class="line">                List&lt;String&gt; batch = texts.subList(i, endIndex);</span><br><span class="line">                </span><br><span class="line">                List&lt;String&gt; processedBatch = batch.stream()</span><br><span class="line">                    .map(<span class="built_in">this</span>::preprocessText)</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">                </span><br><span class="line">                <span class="type">EmbeddingResult</span> <span class="variable">result</span> <span class="operator">=</span> openAiService.createEmbeddings(processedBatch);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">for</span> (Embedding embedding : result.getData()) &#123;</span><br><span class="line">                    allEmbeddings.add(convertToFloatArray(embedding.getEmbedding()));</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// æ·»åŠ å»¶è¿Ÿï¼Œé¿å…è§¦å‘APIé™æµ</span></span><br><span class="line">                <span class="keyword">if</span> (endIndex &lt; texts.size()) &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> allEmbeddings;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;æ‰¹é‡æ–‡æœ¬å‘é‡åŒ–å¤±è´¥&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ‰¹é‡æ–‡æœ¬å‘é‡åŒ–å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æœ¬é¢„å¤„ç†</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦é¢„å¤„ç†ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. é•¿åº¦æ§åˆ¶ï¼šç¡®ä¿æ–‡æœ¬åœ¨æ¨¡å‹é™åˆ¶å†…</span></span><br><span class="line"><span class="comment">     * 2. æ ¼å¼æ¸…ç†ï¼šå»é™¤å¤šä½™çš„æ ¼å¼å­—ç¬¦</span></span><br><span class="line"><span class="comment">     * 3. è¯­è¨€æ ‡å‡†åŒ–ï¼šç»Ÿä¸€è¯­è¨€ç¼–ç </span></span><br><span class="line"><span class="comment">     * 4. è´¨é‡æå‡ï¼šæé«˜å‘é‡åŒ–è´¨é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">preprocessText</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (text == <span class="literal">null</span> || text.trim().isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. å»é™¤å¤šä½™ç©ºç™½å­—ç¬¦</span></span><br><span class="line">        text = text.replaceAll(<span class="string">&quot;\\s+&quot;</span>, <span class="string">&quot; &quot;</span>).trim();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ§åˆ¶é•¿åº¦</span></span><br><span class="line">        <span class="keyword">if</span> (text.length() &gt; <span class="number">8000</span>) &#123; <span class="comment">// OpenAIçš„åˆç†é•¿åº¦é™åˆ¶</span></span><br><span class="line">            text = text.substring(<span class="number">0</span>, <span class="number">8000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. å»é™¤ç‰¹æ®Šå­—ç¬¦</span></span><br><span class="line">        text = text.replaceAll(<span class="string">&quot;[\\x00-\\x1F\\x7F-\\x9F]&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è½¬æ¢å‘é‡æ ¼å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span>[] convertToFloatArray(List&lt;Double&gt; embedding) &#123;</span><br><span class="line">        <span class="type">float</span>[] result = <span class="keyword">new</span> <span class="title class_">float</span>[embedding.size()];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; embedding.size(); i++) &#123;</span><br><span class="line">            result[i] = embedding.get(i).floatValue();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"><a href="#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"></a>æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h2><h3 id="1-ç´¢å¼•ä¼˜åŒ–"><a href="#1-ç´¢å¼•ä¼˜åŒ–" class="headerlink" title="1. ç´¢å¼•ä¼˜åŒ–"></a>1. ç´¢å¼•ä¼˜åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexOptimizationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ¨æ€ç´¢å¼•é€‰æ‹©ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€ç´¢å¼•é€‰æ‹©ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. æ•°æ®ç‰¹å¾ï¼šä¸åŒæ•°æ®é€‚åˆä¸åŒç´¢å¼•</span></span><br><span class="line"><span class="comment">     * 2. æŸ¥è¯¢æ¨¡å¼ï¼šä¸åŒæŸ¥è¯¢éœ€è¦ä¸åŒç´¢å¼•</span></span><br><span class="line"><span class="comment">     * 3. æ€§èƒ½å¹³è¡¡ï¼šå¹³è¡¡æ„å»ºæ—¶é—´å’ŒæŸ¥è¯¢æ—¶é—´</span></span><br><span class="line"><span class="comment">     * 4. èµ„æºé™åˆ¶ï¼šè€ƒè™‘å†…å­˜å’Œå­˜å‚¨é™åˆ¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">optimizeIndex</span><span class="params">(String collectionName, DatasetCharacteristics characteristics)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ ¹æ®æ•°æ®é‡é€‰æ‹©ç´¢å¼•ç±»å‹</span></span><br><span class="line">        <span class="keyword">if</span> (characteristics.getDataSize() &lt; <span class="number">10000</span>) &#123;</span><br><span class="line">            <span class="comment">// å°æ•°æ®é›†ï¼šä½¿ç”¨FLATç´¢å¼•ï¼Œå‡†ç¡®æ€§ä¼˜å…ˆ</span></span><br><span class="line">            createFlatIndex(collectionName);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (characteristics.getDataSize() &lt; <span class="number">100000</span>) &#123;</span><br><span class="line">            <span class="comment">// ä¸­ç­‰æ•°æ®é›†ï¼šä½¿ç”¨IVF_FLAT</span></span><br><span class="line">            createIvfFlatIndex(collectionName, <span class="number">128</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¤§æ•°æ®é›†ï¼šä½¿ç”¨IVF_PQï¼Œå‹ç¼©å­˜å‚¨</span></span><br><span class="line">            createIvfPQIndex(collectionName, <span class="number">128</span>, <span class="number">64</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * IVF_FLATç´¢å¼•ï¼šå¹³è¡¡å‡†ç¡®æ€§å’Œæ€§èƒ½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">createIvfFlatIndex</span><span class="params">(String collectionName, <span class="type">int</span> nlist)</span> &#123;</span><br><span class="line">        <span class="comment">// nlistï¼šèšç±»ä¸­å¿ƒæ•°é‡ï¼Œå½±å“ç´¢å¼•æ„å»ºæ—¶é—´å’ŒæŸ¥è¯¢æ€§èƒ½</span></span><br><span class="line">        <span class="comment">// ç»éªŒå€¼ï¼šnlist = sqrt(æ•°æ®é‡)ï¼Œä½†ä¸è¶…è¿‡4*sqrt(æ•°æ®é‡)</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * IVF_PQç´¢å¼•ï¼šç‰ºç‰²å°‘é‡å‡†ç¡®æ€§ï¼Œè·å¾—æ›´å¥½çš„å‹ç¼©æ•ˆæœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">createIvfPQIndex</span><span class="params">(String collectionName, <span class="type">int</span> nlist, <span class="type">int</span> m)</span> &#123;</span><br><span class="line">        <span class="comment">// mï¼šå‘é‡è¢«åˆ†å‰²çš„æ®µæ•°ï¼Œå½±å“å‹ç¼©ç‡å’Œå‡†ç¡®æ€§</span></span><br><span class="line">        <span class="comment">// ç»éªŒå€¼ï¼šm = ç»´åº¦/4ï¼Œä½†ä¸è¶…è¿‡ç»´åº¦/2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-ç¼“å­˜ç­–ç•¥"><a href="#2-ç¼“å­˜ç­–ç•¥" class="headerlink" title="2. ç¼“å­˜ç­–ç•¥"></a>2. ç¼“å­˜ç­–ç•¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤šçº§ç¼“å­˜ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦å¤šçº§ç¼“å­˜ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. æŸ¥è¯¢åŠ é€Ÿï¼šé¿å…é‡å¤å‘é‡æ£€ç´¢</span></span><br><span class="line"><span class="comment">     * 2. æˆæœ¬æ§åˆ¶ï¼šå‡å°‘å‘é‡åŒ–APIè°ƒç”¨</span></span><br><span class="line"><span class="comment">     * 3. ç”¨æˆ·ä½“éªŒï¼šæé«˜å“åº”é€Ÿåº¦</span></span><br><span class="line"><span class="comment">     * 4. ç³»ç»Ÿç¨³å®šæ€§ï¼šå‡è½»ä¸‹æ¸¸æœåŠ¡å‹åŠ›</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‘é‡ç¼“å­˜ï¼šç¼“å­˜æŸ¥è¯¢å‘é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">VECTOR_CACHE_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;rag:vector:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Duration</span> <span class="variable">VECTOR_CACHE_TTL</span> <span class="operator">=</span> Duration.ofHours(<span class="number">24</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»“æœç¼“å­˜ï¼šç¼“å­˜æ£€ç´¢ç»“æœ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RESULT_CACHE_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;rag:result:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Duration</span> <span class="variable">RESULT_CACHE_TTL</span> <span class="operator">=</span> Duration.ofHours(<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç­”æ¡ˆç¼“å­˜ï¼šç¼“å­˜å®Œæ•´ç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ANSWER_CACHE_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;rag:answer:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Duration</span> <span class="variable">ANSWER_CACHE_TTL</span> <span class="operator">=</span> Duration.ofMinutes(<span class="number">30</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç¼“å­˜çš„å‘é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">float</span>[] getCachedVector(String text) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> VECTOR_CACHE_PREFIX + DigestUtils.md5Hex(text);</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">float</span>[]) redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼“å­˜å‘é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cacheVector</span><span class="params">(String text, <span class="type">float</span>[] vector)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> VECTOR_CACHE_PREFIX + DigestUtils.md5Hex(text);</span><br><span class="line">        redisTemplate.opsForValue().set(key, vector, VECTOR_CACHE_TTL);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç¼“å­˜çš„æ£€ç´¢ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SearchResult&gt; <span class="title function_">getCachedResults</span><span class="params">(String query, String category)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RESULT_CACHE_PREFIX + DigestUtils.md5Hex(query + category);</span><br><span class="line">        <span class="keyword">return</span> (List&lt;SearchResult&gt;) redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼“å­˜æ£€ç´¢ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cacheResults</span><span class="params">(String query, String category, List&lt;SearchResult&gt; results)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RESULT_CACHE_PREFIX + DigestUtils.md5Hex(query + category);</span><br><span class="line">        redisTemplate.opsForValue().set(key, results, RESULT_CACHE_TTL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-å¹¶å‘æ§åˆ¶"><a href="#3-å¹¶å‘æ§åˆ¶" class="headerlink" title="3. å¹¶å‘æ§åˆ¶"></a>3. å¹¶å‘æ§åˆ¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çº¿ç¨‹æ± é…ç½®</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. æ§åˆ¶å¹¶å‘ï¼šé¿å…è¿‡å¤šçš„å¹¶å‘è¯·æ±‚</span></span><br><span class="line"><span class="comment">     * 2. èµ„æºéš”ç¦»ï¼šä¸Webå®¹å™¨çº¿ç¨‹æ± åˆ†ç¦»</span></span><br><span class="line"><span class="comment">     * 3. æ€§èƒ½ç›‘æ§ï¼šä¾¿äºç›‘æ§å’Œè°ƒä¼˜</span></span><br><span class="line"><span class="comment">     * 4. é”™è¯¯éš”ç¦»ï¼šé¿å…æŸä¸ªä»»åŠ¡å½±å“æ•´ä¸ªç³»ç»Ÿ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean(&quot;ragTaskExecutor&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ThreadPoolTaskExecutor <span class="title function_">ragTaskExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ThreadPoolTaskExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ ¸å¿ƒçº¿ç¨‹æ•°ï¼šæ ¹æ®CPUæ ¸å¿ƒæ•°è®¾ç½®</span></span><br><span class="line">        executor.setCorePoolSize(Runtime.getRuntime().availableProcessors());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æœ€å¤§çº¿ç¨‹æ•°ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°çš„2å€</span></span><br><span class="line">        executor.setMaxPoolSize(Runtime.getRuntime().availableProcessors() * <span class="number">2</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—å®¹é‡ï¼šæ§åˆ¶ç­‰å¾…ä»»åŠ¡æ•°é‡</span></span><br><span class="line">        executor.setQueueCapacity(<span class="number">100</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// çº¿ç¨‹åå‰ç¼€ï¼šä¾¿äºæ—¥å¿—è¿½è¸ª</span></span><br><span class="line">        executor.setThreadNamePrefix(<span class="string">&quot;rag-task-&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‹’ç»ç­–ç•¥ï¼šè°ƒç”¨è€…è¿è¡Œ</span></span><br><span class="line">        executor.setRejectedExecutionHandler(<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´</span></span><br><span class="line">        executor.setKeepAliveSeconds(<span class="number">60</span>);</span><br><span class="line">        </span><br><span class="line">        executor.initialize();</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç›‘æ§å’Œè¿ç»´"><a href="#ç›‘æ§å’Œè¿ç»´" class="headerlink" title="ç›‘æ§å’Œè¿ç»´"></a>ç›‘æ§å’Œè¿ç»´</h2><h3 id="1-æŒ‡æ ‡ç›‘æ§"><a href="#1-æŒ‡æ ‡ç›‘æ§" class="headerlink" title="1. æŒ‡æ ‡ç›‘æ§"></a>1. æŒ‡æ ‡ç›‘æ§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MetricsService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MeterRegistry meterRegistry;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¡æ•°å™¨ï¼šè®°å½•å„ç§æ“ä½œæ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter documentProcessedCounter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter searchRequestCounter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Counter answerGeneratedCounter;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¡æ—¶å™¨ï¼šè®°å½•æ“ä½œè€—æ—¶</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer documentProcessingTimer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer searchTimer;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Timer answerGenerationTimer;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç›´æ–¹å›¾ï¼šè®°å½•æ•°å€¼åˆ†å¸ƒ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DistributionSummary searchResultSizeSummary;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DistributionSummary contextLengthSummary;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MetricsService</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.meterRegistry = meterRegistry;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–è®¡æ•°å™¨</span></span><br><span class="line">        <span class="built_in">this</span>.documentProcessedCounter = Counter.builder(<span class="string">&quot;rag_documents_processed_total&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;Total number of documents processed&quot;</span>)</span><br><span class="line">                .register(meterRegistry);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">this</span>.searchRequestCounter = Counter.builder(<span class="string">&quot;rag_search_requests_total&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;Total number of search requests&quot;</span>)</span><br><span class="line">                .register(meterRegistry);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–è®¡æ—¶å™¨</span></span><br><span class="line">        <span class="built_in">this</span>.documentProcessingTimer = Timer.builder(<span class="string">&quot;rag_document_processing_duration&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;Document processing duration&quot;</span>)</span><br><span class="line">                .register(meterRegistry);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ç›´æ–¹å›¾</span></span><br><span class="line">        <span class="built_in">this</span>.searchResultSizeSummary = DistributionSummary.builder(<span class="string">&quot;rag_search_results_size&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;Size of search results&quot;</span>)</span><br><span class="line">                .register(meterRegistry);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®°å½•æ–‡æ¡£å¤„ç†æŒ‡æ ‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordDocumentProcessing</span><span class="params">(<span class="type">long</span> duration, <span class="type">int</span> chunkCount)</span> &#123;</span><br><span class="line">        documentProcessedCounter.increment();</span><br><span class="line">        documentProcessingTimer.record(Duration.ofMillis(duration));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®°å½•åˆ†å—æ•°é‡</span></span><br><span class="line">        Gauge.builder(<span class="string">&quot;rag_document_chunks&quot;</span>, () -&gt; chunkCount)</span><br><span class="line">                .description(<span class="string">&quot;Number of chunks in last processed document&quot;</span>)</span><br><span class="line">                .register(meterRegistry);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®°å½•æœç´¢æŒ‡æ ‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordSearch</span><span class="params">(<span class="type">long</span> duration, <span class="type">int</span> resultCount, <span class="type">double</span> avgScore)</span> &#123;</span><br><span class="line">        searchRequestCounter.increment();</span><br><span class="line">        searchTimer.record(Duration.ofMillis(duration));</span><br><span class="line">        searchResultSizeSummary.record(resultCount);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®°å½•å¹³å‡ç›¸ä¼¼åº¦</span></span><br><span class="line">        Gauge.builder(<span class="string">&quot;rag_search_avg_score&quot;</span>, () -&gt; avgScore)</span><br><span class="line">                .description(<span class="string">&quot;Average similarity score of search results&quot;</span>)</span><br><span class="line">                .register(meterRegistry);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-å¥åº·æ£€æŸ¥"><a href="#2-å¥åº·æ£€æŸ¥" class="headerlink" title="2. å¥åº·æ£€æŸ¥"></a>2. å¥åº·æ£€æŸ¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HealthCheckService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MilvusService milvusService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmbeddingService embeddingService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OpenAiService openAiService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»¼åˆå¥åº·æ£€æŸ¥</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦å¥åº·æ£€æŸ¥ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. æ•…éšœæ£€æµ‹ï¼šåŠæ—¶å‘ç°ç³»ç»Ÿæ•…éšœ</span></span><br><span class="line"><span class="comment">     * 2. è‡ªåŠ¨æ¢å¤ï¼šè§¦å‘è‡ªåŠ¨æ¢å¤æœºåˆ¶</span></span><br><span class="line"><span class="comment">     * 3. çŠ¶æ€ç›‘æ§ï¼šä¸ºè¿ç»´æä¾›ç³»ç»ŸçŠ¶æ€</span></span><br><span class="line"><span class="comment">     * 4. è´Ÿè½½å‡è¡¡ï¼šå¥åº·æ£€æŸ¥æ˜¯è´Ÿè½½å‡è¡¡çš„åŸºç¡€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> HealthStatus <span class="title function_">checkSystemHealth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HealthStatus</span> <span class="variable">status</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HealthStatus</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æŸ¥Milvusè¿æ¥</span></span><br><span class="line">        status.setMilvusHealthy(checkMilvusHealth());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æŸ¥EmbeddingæœåŠ¡</span></span><br><span class="line">        status.setEmbeddingHealthy(checkEmbeddingHealth());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æŸ¥OpenAIæœåŠ¡</span></span><br><span class="line">        status.setOpenAiHealthy(checkOpenAiHealth());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æŸ¥ç³»ç»Ÿèµ„æº</span></span><br><span class="line">        status.setSystemHealthy(checkSystemResources());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ€»ä½“å¥åº·çŠ¶æ€</span></span><br><span class="line">        status.setOverallHealthy(</span><br><span class="line">            status.isMilvusHealthy() &amp;&amp; </span><br><span class="line">            status.isEmbeddingHealthy() &amp;&amp; </span><br><span class="line">            status.isOpenAiHealthy() &amp;&amp; </span><br><span class="line">            status.isSystemHealthy()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥Milvuså¥åº·çŠ¶æ€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkMilvusHealth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œç®€å•çš„é›†åˆå­˜åœ¨æ€§æ£€æŸ¥</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> milvusService.collectionExists();</span><br><span class="line">            <span class="keyword">return</span> exists;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Milvuså¥åº·æ£€æŸ¥å¤±è´¥&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥EmbeddingæœåŠ¡å¥åº·çŠ¶æ€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkEmbeddingHealth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œç®€å•çš„å‘é‡åŒ–æµ‹è¯•</span></span><br><span class="line">            <span class="type">float</span>[] vector = embeddingService.embedText(<span class="string">&quot;å¥åº·æ£€æŸ¥æµ‹è¯•&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> vector != <span class="literal">null</span> &amp;&amp; vector.length &gt; <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;EmbeddingæœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥ç³»ç»Ÿèµ„æº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkSystemResources</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥å†…å­˜ä½¿ç”¨ç‡</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">memoryUsage</span> <span class="operator">=</span> getMemoryUsage();</span><br><span class="line">        <span class="keyword">if</span> (memoryUsage &gt; <span class="number">0.9</span>) &#123; <span class="comment">// å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90%</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æŸ¥ç£ç›˜ç©ºé—´</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">diskUsage</span> <span class="operator">=</span> getDiskUsage();</span><br><span class="line">        <span class="keyword">if</span> (diskUsage &gt; <span class="number">0.9</span>) &#123; <span class="comment">// ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡90%</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹"><a href="#æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹" class="headerlink" title="æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹"></a>æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹</h2><h3 id="1-æ•°æ®ç®¡ç†æœ€ä½³å®è·µ"><a href="#1-æ•°æ®ç®¡ç†æœ€ä½³å®è·µ" class="headerlink" title="1. æ•°æ®ç®¡ç†æœ€ä½³å®è·µ"></a>1. æ•°æ®ç®¡ç†æœ€ä½³å®è·µ</h3><h4 id="æ–‡æ¡£é¢„å¤„ç†"><a href="#æ–‡æ¡£é¢„å¤„ç†" class="headerlink" title="æ–‡æ¡£é¢„å¤„ç†"></a>æ–‡æ¡£é¢„å¤„ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentPreprocessingBestPractices</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æ¡£è´¨é‡è¯„ä¼°</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦è´¨é‡è¯„ä¼°ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. è¿‡æ»¤ä½è´¨é‡å†…å®¹ï¼šé¿å…æ±¡æŸ“çŸ¥è¯†åº“</span></span><br><span class="line"><span class="comment">     * 2. æé«˜æ£€ç´¢å‡†ç¡®æ€§ï¼šé«˜è´¨é‡å†…å®¹æ£€ç´¢æ•ˆæœæ›´å¥½</span></span><br><span class="line"><span class="comment">     * 3. èŠ‚çœå­˜å‚¨å’Œè®¡ç®—èµ„æºï¼šå‡å°‘æ— æ•ˆæ•°æ®å¤„ç†</span></span><br><span class="line"><span class="comment">     * 4. ç»´æŠ¤çŸ¥è¯†åº“çº¯å‡€æ€§ï¼šé•¿æœŸä¿æŒçŸ¥è¯†åº“è´¨é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">assessDocumentQuality</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ£€æŸ¥å†…å®¹é•¿åº¦</span></span><br><span class="line">        <span class="keyword">if</span> (content.length() &lt; <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// å†…å®¹è¿‡çŸ­</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ£€æŸ¥å†…å®¹å¯†åº¦</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">textDensity</span> <span class="operator">=</span> calculateTextDensity(content);</span><br><span class="line">        <span class="keyword">if</span> (textDensity &lt; <span class="number">0.3</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// æ–‡æœ¬å¯†åº¦è¿‡ä½ï¼Œå¯èƒ½åŒ…å«è¿‡å¤šæ ¼å¼å­—ç¬¦</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æ£€æŸ¥é‡å¤å†…å®¹</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">uniqueness</span> <span class="operator">=</span> calculateUniqueness(content);</span><br><span class="line">        <span class="keyword">if</span> (uniqueness &lt; <span class="number">0.6</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// é‡å¤å†…å®¹è¿‡å¤š</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. æ£€æŸ¥è¯­è¨€è´¨é‡</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isValidLanguage</span> <span class="operator">=</span> validateLanguage(content);</span><br><span class="line">        <span class="keyword">if</span> (!isValidLanguage) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// è¯­è¨€ä¸ç¬¦åˆè¦æ±‚</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¢é‡æ›´æ–°ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦å¢é‡æ›´æ–°ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. å®æ—¶æ€§ï¼šæ–°æ–‡æ¡£å¯ä»¥ç«‹å³è¢«æ£€ç´¢</span></span><br><span class="line"><span class="comment">     * 2. æ•ˆç‡ï¼šé¿å…å…¨é‡é‡å»ºç´¢å¼•</span></span><br><span class="line"><span class="comment">     * 3. å¯ç”¨æ€§ï¼šæ›´æ–°è¿‡ç¨‹ä¸­ä¸å½±å“ç°æœ‰æœåŠ¡</span></span><br><span class="line"><span class="comment">     * 4. ç‰ˆæœ¬æ§åˆ¶ï¼šæ”¯æŒæ–‡æ¡£ç‰ˆæœ¬ç®¡ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incrementalUpdate</span><span class="params">(List&lt;DocumentChunk&gt; newChunks)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ ‡è®°æ—§ç‰ˆæœ¬ä¸ºè¿‡æœŸ</span></span><br><span class="line">        markOldVersionsExpired(newChunks);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ’å…¥æ–°ç‰ˆæœ¬</span></span><br><span class="line">        insertNewVersions(newChunks);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. å¼‚æ­¥é‡å»ºç´¢å¼•</span></span><br><span class="line">        scheduleIndexRebuild();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. æ¸…ç†è¿‡æœŸæ•°æ®</span></span><br><span class="line">        cleanupExpiredData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åˆ†å—ç­–ç•¥ä¼˜åŒ–"><a href="#åˆ†å—ç­–ç•¥ä¼˜åŒ–" class="headerlink" title="åˆ†å—ç­–ç•¥ä¼˜åŒ–"></a>åˆ†å—ç­–ç•¥ä¼˜åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChunkingStrategy</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ™ºèƒ½åˆ†å—ç®—æ³•</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦æ™ºèƒ½åˆ†å—ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. è¯­ä¹‰å®Œæ•´æ€§ï¼šä¿æŒè¯­ä¹‰å•å…ƒçš„å®Œæ•´æ€§</span></span><br><span class="line"><span class="comment">     * 2. æ£€ç´¢ç²’åº¦ï¼šå¹³è¡¡æ£€ç´¢ç²¾åº¦å’Œä¸Šä¸‹æ–‡å®Œæ•´æ€§</span></span><br><span class="line"><span class="comment">     * 3. å­˜å‚¨æ•ˆç‡ï¼šé¿å…è¿‡åº¦åˆ†å‰²é€ æˆçš„å­˜å‚¨æµªè´¹</span></span><br><span class="line"><span class="comment">     * 4. æŸ¥è¯¢æ•ˆç‡ï¼šå‡å°‘éœ€è¦æ£€ç´¢çš„åˆ†å—æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŸºäºè¯­ä¹‰çš„åˆ†å—</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">semanticChunking</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. å¥å­åˆ†å‰²</span></span><br><span class="line">        List&lt;String&gt; sentences = splitIntoSentences(content);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—</span></span><br><span class="line">        List&lt;String&gt; chunks = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">currentChunk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (String sentence : sentences) &#123;</span><br><span class="line">            <span class="keyword">if</span> (shouldStartNewChunk(currentChunk.toString(), sentence)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (currentChunk.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    chunks.add(currentChunk.toString());</span><br><span class="line">                    currentChunk = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            currentChunk.append(sentence).append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (currentChunk.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            chunks.add(currentChunk.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chunks;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­æ˜¯å¦éœ€è¦å¼€å§‹æ–°åˆ†å—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">shouldStartNewChunk</span><span class="params">(String currentChunk, String nextSentence)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. é•¿åº¦æ£€æŸ¥</span></span><br><span class="line">        <span class="keyword">if</span> (currentChunk.length() + nextSentence.length() &gt; MAX_CHUNK_SIZE) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. è¯­ä¹‰ç›¸ä¼¼åº¦æ£€æŸ¥</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">similarity</span> <span class="operator">=</span> calculateSemanticSimilarity(currentChunk, nextSentence);</span><br><span class="line">        <span class="keyword">if</span> (similarity &lt; SEMANTIC_THRESHOLD) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-æ€§èƒ½ä¼˜åŒ–å»ºè®®"><a href="#2-æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="2. æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>2. æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3><h4 id="æŸ¥è¯¢ä¼˜åŒ–"><a href="#æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="æŸ¥è¯¢ä¼˜åŒ–"></a>æŸ¥è¯¢ä¼˜åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QueryOptimizationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢é¢„å¤„ç†</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦æŸ¥è¯¢é¢„å¤„ç†ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. æ„å›¾ç†è§£ï¼šå‡†ç¡®ç†è§£ç”¨æˆ·æŸ¥è¯¢æ„å›¾</span></span><br><span class="line"><span class="comment">     * 2. æŸ¥è¯¢æ‰©å±•ï¼šå¢åŠ ç›¸å…³æŸ¥è¯¢è¯</span></span><br><span class="line"><span class="comment">     * 3. å™ªå£°è¿‡æ»¤ï¼šå»é™¤æ— å…³æŸ¥è¯¢è¯</span></span><br><span class="line"><span class="comment">     * 4. æ ¼å¼æ ‡å‡†åŒ–ï¼šç»Ÿä¸€æŸ¥è¯¢æ ¼å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">preprocessQuery</span><span class="params">(String rawQuery)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ–‡æœ¬æ¸…ç†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cleaned</span> <span class="operator">=</span> cleanText(rawQuery);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ„å›¾è¯†åˆ«</span></span><br><span class="line">        <span class="type">QueryIntent</span> <span class="variable">intent</span> <span class="operator">=</span> identifyIntent(cleaned);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æŸ¥è¯¢æ‰©å±•</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">expanded</span> <span class="operator">=</span> expandQuery(cleaned, intent);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. æƒé‡è°ƒæ•´</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">weighted</span> <span class="operator">=</span> adjustWeights(expanded, intent);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> weighted;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤šè·¯æ£€ç´¢ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦å¤šè·¯æ£€ç´¢ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. æé«˜å¬å›ç‡ï¼šä¸åŒç­–ç•¥å¯èƒ½å¬å›ä¸åŒæ–‡æ¡£</span></span><br><span class="line"><span class="comment">     * 2. ç»“æœèåˆï¼šç»¼åˆå¤šç§æ£€ç´¢ç»“æœ</span></span><br><span class="line"><span class="comment">     * 3. å®¹é”™æ€§ï¼šå•ä¸ªç­–ç•¥å¤±è´¥ä¸å½±å“æ•´ä½“ç»“æœ</span></span><br><span class="line"><span class="comment">     * 4. ä¸ªæ€§åŒ–ï¼šæ ¹æ®ç”¨æˆ·ç‰¹ç‚¹è°ƒæ•´æ£€ç´¢ç­–ç•¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SearchResult&gt; <span class="title function_">multiPathRetrieval</span><span class="params">(String query, RetrievalContext context)</span> &#123;</span><br><span class="line">        List&lt;CompletableFuture&lt;List&lt;SearchResult&gt;&gt;&gt; futures = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. å‘é‡æ£€ç´¢</span></span><br><span class="line">        futures.add(CompletableFuture.supplyAsync(() -&gt; </span><br><span class="line">            vectorRetrieval(query, context)));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. å…³é”®è¯æ£€ç´¢</span></span><br><span class="line">        futures.add(CompletableFuture.supplyAsync(() -&gt; </span><br><span class="line">            keywordRetrieval(query, context)));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æ··åˆæ£€ç´¢</span></span><br><span class="line">        futures.add(CompletableFuture.supplyAsync(() -&gt; </span><br><span class="line">            hybridRetrieval(query, context)));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. ç­‰å¾…æ‰€æœ‰æ£€ç´¢å®Œæˆ</span></span><br><span class="line">        List&lt;List&lt;SearchResult&gt;&gt; allResults = futures.stream()</span><br><span class="line">            .map(CompletableFuture::join)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. ç»“æœèåˆ</span></span><br><span class="line">        <span class="keyword">return</span> fuseResults(allResults);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»“æœèåˆç®—æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SearchResult&gt; <span class="title function_">fuseResults</span><span class="params">(List&lt;List&lt;SearchResult&gt;&gt; allResults)</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨RRF (Reciprocal Rank Fusion) ç®—æ³•</span></span><br><span class="line">        Map&lt;String, Double&gt; scoreMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;String, SearchResult&gt; resultMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">60</span>; <span class="comment">// RRFå¸¸æ•°</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (List&lt;SearchResult&gt; results : allResults) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">rank</span> <span class="operator">=</span> <span class="number">0</span>; rank &lt; results.size(); rank++) &#123;</span><br><span class="line">                <span class="type">SearchResult</span> <span class="variable">result</span> <span class="operator">=</span> results.get(rank);</span><br><span class="line">                <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> result.getId();</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// RRFå¾—åˆ†è®¡ç®—</span></span><br><span class="line">                <span class="type">double</span> <span class="variable">rrfScore</span> <span class="operator">=</span> <span class="number">1.0</span> / (k + rank + <span class="number">1</span>);</span><br><span class="line">                scoreMap.put(id, scoreMap.getOrDefault(id, <span class="number">0.0</span>) + rrfScore);</span><br><span class="line">                </span><br><span class="line">                resultMap.put(id, result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æŒ‰èåˆå¾—åˆ†æ’åº</span></span><br><span class="line">        <span class="keyword">return</span> scoreMap.entrySet().stream()</span><br><span class="line">            .sorted(Map.Entry.&lt;String, Double&gt;comparingByValue().reversed())</span><br><span class="line">            .map(entry -&gt; &#123;</span><br><span class="line">                <span class="type">SearchResult</span> <span class="variable">result</span> <span class="operator">=</span> resultMap.get(entry.getKey());</span><br><span class="line">                result.setScore(entry.getValue());</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-å®‰å…¨å’Œåˆè§„è€ƒè™‘"><a href="#3-å®‰å…¨å’Œåˆè§„è€ƒè™‘" class="headerlink" title="3. å®‰å…¨å’Œåˆè§„è€ƒè™‘"></a>3. å®‰å…¨å’Œåˆè§„è€ƒè™‘</h3><h4 id="æ•°æ®å®‰å…¨"><a href="#æ•°æ®å®‰å…¨" class="headerlink" title="æ•°æ®å®‰å…¨"></a>æ•°æ®å®‰å…¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®åŠ å¯†ç­–ç•¥</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åŠ å¯†ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. é˜²æ­¢æ•°æ®æ³„éœ²ï¼šä¿æŠ¤æ•æ„Ÿä¼ä¸šä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * 2. åˆè§„è¦æ±‚ï¼šæ»¡è¶³GDPRç­‰æ³•è§„è¦æ±‚</span></span><br><span class="line"><span class="comment">     * 3. è®¿é—®æ§åˆ¶ï¼šç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·è®¿é—®æ•°æ®</span></span><br><span class="line"><span class="comment">     * 4. å®¡è®¡è¿½è¸ªï¼šè®°å½•æ•°æ®è®¿é—®å†å²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">encryptSensitiveData</span><span class="params">(DocumentChunk chunk)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. è¯†åˆ«æ•æ„Ÿä¿¡æ¯</span></span><br><span class="line">        List&lt;String&gt; sensitiveFields = identifySensitiveFields(chunk);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. åŠ å¯†æ•æ„Ÿå­—æ®µ</span></span><br><span class="line">        <span class="keyword">for</span> (String field : sensitiveFields) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">encrypted</span> <span class="operator">=</span> encryptField(chunk.getFieldValue(field));</span><br><span class="line">            chunk.setFieldValue(field, encrypted);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æ·»åŠ åŠ å¯†å…ƒæ•°æ®</span></span><br><span class="line">        chunk.setEncryptionMetadata(buildEncryptionMetadata());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¿é—®æ§åˆ¶</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦è®¿é—®æ§åˆ¶ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. æ•°æ®éš”ç¦»ï¼šä¸åŒéƒ¨é—¨æ•°æ®ç›¸äº’éš”ç¦»</span></span><br><span class="line"><span class="comment">     * 2. æƒé™åˆ†çº§ï¼šä¸åŒç”¨æˆ·æœ‰ä¸åŒè®¿é—®æƒé™</span></span><br><span class="line"><span class="comment">     * 3. å®¡è®¡æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰è®¿é—®è¡Œä¸º</span></span><br><span class="line"><span class="comment">     * 4. åˆè§„è¦æ±‚ï¼šæ»¡è¶³ä¼ä¸šå®‰å…¨ç­–ç•¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkAccessPermission</span><span class="params">(String userId, String resourceId, </span></span><br><span class="line"><span class="params">                                       String action)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. ç”¨æˆ·èº«ä»½éªŒè¯</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> authenticateUser(userId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æƒé™æ£€æŸ¥</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasPermission</span> <span class="operator">=</span> authorizationService.checkPermission(</span><br><span class="line">            user, resourceId, action);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. å®¡è®¡æ—¥å¿—</span></span><br><span class="line">        auditService.logAccess(userId, resourceId, action, hasPermission);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> hasPermission;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®è„±æ•</span></span><br><span class="line"><span class="comment">     * ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®è„±æ•ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * 1. ä¿æŠ¤éšç§ï¼šéšè—ä¸ªäººæ•æ„Ÿä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * 2. æµ‹è¯•ç¯å¢ƒï¼šä¸ºæµ‹è¯•æä¾›å®‰å…¨æ•°æ®</span></span><br><span class="line"><span class="comment">     * 3. ç¬¬ä¸‰æ–¹å…±äº«ï¼šå®‰å…¨åœ°å…±äº«æ•°æ®ç»™åˆä½œä¼™ä¼´</span></span><br><span class="line"><span class="comment">     * 4. åˆè§„è¦æ±‚ï¼šæ»¡è¶³æ•°æ®ä¿æŠ¤æ³•è§„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">desensitizeData</span><span class="params">(String content, DesensitizeLevel level)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (level) &#123;</span><br><span class="line">            <span class="keyword">case</span> LOW:</span><br><span class="line">                <span class="keyword">return</span> maskEmails(content);</span><br><span class="line">            <span class="keyword">case</span> MEDIUM:</span><br><span class="line">                <span class="keyword">return</span> maskEmailsAndPhones(content);</span><br><span class="line">            <span class="keyword">case</span> HIGH:</span><br><span class="line">                <span class="keyword">return</span> maskAllPII(content);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> content;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="éƒ¨ç½²å’Œè¿ç»´"><a href="#éƒ¨ç½²å’Œè¿ç»´" class="headerlink" title="éƒ¨ç½²å’Œè¿ç»´"></a>éƒ¨ç½²å’Œè¿ç»´</h2><h3 id="1-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"><a href="#1-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²" class="headerlink" title="1. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"></a>1. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</h3><h4 id="Docker-Composeéƒ¨ç½²"><a href="#Docker-Composeéƒ¨ç½²" class="headerlink" title="Docker Composeéƒ¨ç½²"></a>Docker Composeéƒ¨ç½²</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># production-docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">rag-service:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">enterprise-rag:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=prod</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MILVUS_HOST=milvus-standalone</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDIS_HOST=redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">OPENAI_API_KEY=$&#123;OPENAI_API_KEY&#125;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">milvus-standalone</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./logs:/app/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config:/app/config</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">milvus-standalone:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">milvusdb/milvus:v2.3.6</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;19530:19530&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9091:9091&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">milvus_data:/var/lib/milvus</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;milvus&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;standalone&quot;</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:7-alpine</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis_data:/data</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/prometheus:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9090:9090&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">prometheus_data:/prometheus</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana:latest</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_SECURITY_ADMIN_PASSWORD=admin</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">grafana_data:/var/lib/grafana</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">milvus_data:</span></span><br><span class="line">  <span class="attr">redis_data:</span></span><br><span class="line">  <span class="attr">prometheus_data:</span></span><br><span class="line">  <span class="attr">grafana_data:</span></span><br></pre></td></tr></table></figure>

<h4 id="Kuberneteséƒ¨ç½²"><a href="#Kuberneteséƒ¨ç½²" class="headerlink" title="Kuberneteséƒ¨ç½²"></a>Kuberneteséƒ¨ç½²</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rag-deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">rag-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">rag-service</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">rag-service</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rag-service</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">enterprise-rag:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MILVUS_HOST</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;milvus-cluster&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">REDIS_HOST</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;redis-cluster&quot;</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;2Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1000m&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;4Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;2000m&quot;</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">30</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">rag-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">rag-service</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span></span><br></pre></td></tr></table></figure>

<h3 id="2-ç›‘æ§å‘Šè­¦é…ç½®"><a href="#2-ç›‘æ§å‘Šè­¦é…ç½®" class="headerlink" title="2. ç›‘æ§å‘Šè­¦é…ç½®"></a>2. ç›‘æ§å‘Šè­¦é…ç½®</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># prometheus.yml</span></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rule_files:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;alert_rules.yml&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;rag-service&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;rag-service:8080&#x27;</span>]</span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">&#x27;/actuator/prometheus&#x27;</span></span><br><span class="line">    </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;milvus&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;milvus-standalone:9091&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># alert_rules.yml</span></span><br><span class="line"><span class="attr">groups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RAGAlerts</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighErrorRate</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">rate(http_requests_total&#123;status=~&quot;5..&quot;&#125;[5m])</span> <span class="string">&gt;</span> <span class="number">0.05</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">        <span class="attr">annotations:</span></span><br><span class="line">          <span class="attr">summary:</span> <span class="string">&quot;High error rate detected&quot;</span></span><br><span class="line">          </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">MilvusDown</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">up&#123;job=&quot;milvus&quot;&#125;</span> <span class="string">==</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">        <span class="attr">annotations:</span></span><br><span class="line">          <span class="attr">summary:</span> <span class="string">&quot;Milvus service is down&quot;</span></span><br><span class="line">          </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighMemoryUsage</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">(1</span> <span class="bullet">-</span> <span class="string">system_memory_available</span> <span class="string">/</span> <span class="string">system_memory_total)</span> <span class="string">&gt;</span> <span class="number">0.9</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">        <span class="attr">annotations:</span></span><br><span class="line">          <span class="attr">summary:</span> <span class="string">&quot;High memory usage detected&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="æ ¸å¿ƒä»·å€¼"><a href="#æ ¸å¿ƒä»·å€¼" class="headerlink" title="æ ¸å¿ƒä»·å€¼"></a>æ ¸å¿ƒä»·å€¼</h3><p>é€šè¿‡æœ¬æ–‡è¯¦ç»†ä»‹ç»çš„Java+Milvusä¼ä¸šçº§RAGç³»ç»Ÿï¼Œä¼ä¸šå¯ä»¥ï¼š</p>
<ol>
<li><strong>æ„å»ºæ™ºèƒ½åŒ–çŸ¥è¯†åº“</strong>ï¼šå°†ä¼ä¸šæ–‡æ¡£è½¬æ¢ä¸ºå¯å¯¹è¯çš„çŸ¥è¯†èµ„äº§</li>
<li><strong>æå‡å·¥ä½œæ•ˆç‡</strong>ï¼šå‘˜å·¥å¯ä»¥å¿«é€Ÿè·å–å‡†ç¡®çš„ä¼ä¸šä¿¡æ¯</li>
<li><strong>é™ä½è¿è¥æˆæœ¬</strong>ï¼šå‡å°‘äººå·¥å®¢æœå’ŒçŸ¥è¯†æŸ¥æ‰¾çš„æ—¶é—´</li>
<li><strong>ä¿è¯æ•°æ®å®‰å…¨</strong>ï¼šæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨ä¼ä¸šå†…éƒ¨ç¯å¢ƒ</li>
<li><strong>æŒç»­å­¦ä¹ èƒ½åŠ›</strong>ï¼šç³»ç»Ÿå¯ä»¥æŒç»­çº³å…¥æ–°çŸ¥è¯†</li>
</ol>
<h3 id="æŠ€æœ¯äº®ç‚¹"><a href="#æŠ€æœ¯äº®ç‚¹" class="headerlink" title="æŠ€æœ¯äº®ç‚¹"></a>æŠ€æœ¯äº®ç‚¹</h3><h4 id="æ¶æ„ä¼˜åŠ¿"><a href="#æ¶æ„ä¼˜åŠ¿" class="headerlink" title="æ¶æ„ä¼˜åŠ¿"></a>æ¶æ„ä¼˜åŠ¿</h4><ul>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šå„ç»„ä»¶ç‹¬ç«‹éƒ¨ç½²ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•</li>
<li><strong>é«˜å¯ç”¨æ¶æ„</strong>ï¼šé›†ç¾¤éƒ¨ç½²ä¿è¯æœåŠ¡è¿ç»­æ€§</li>
<li><strong>å¼¹æ€§ä¼¸ç¼©</strong>ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´èµ„æº</li>
<li><strong>å¤šçº§ç¼“å­˜</strong>ï¼šä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ</li>
</ul>
<h4 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h4><ul>
<li><strong>æ™ºèƒ½åˆ†å—</strong>ï¼šå¹³è¡¡è¯­ä¹‰å®Œæ•´æ€§å’Œæ£€ç´¢æ•ˆç‡</li>
<li><strong>å¤šè·¯æ£€ç´¢</strong>ï¼šæé«˜å¬å›ç‡å’Œå‡†ç¡®æ€§</li>
<li><strong>å¢é‡æ›´æ–°</strong>ï¼šæ”¯æŒå®æ—¶çŸ¥è¯†æ›´æ–°</li>
<li><strong>å¹¶å‘æ§åˆ¶</strong>ï¼šä¿è¯ç³»ç»Ÿç¨³å®šæ€§å’Œå“åº”é€Ÿåº¦</li>
</ul>
<h4 id="å®‰å…¨åˆè§„"><a href="#å®‰å…¨åˆè§„" class="headerlink" title="å®‰å…¨åˆè§„"></a>å®‰å…¨åˆè§„</h4><ul>
<li><strong>æ•°æ®åŠ å¯†</strong>ï¼šä¿æŠ¤æ•æ„Ÿä¼ä¸šä¿¡æ¯</li>
<li><strong>è®¿é—®æ§åˆ¶</strong>ï¼šç»†ç²’åº¦æƒé™ç®¡ç†</li>
<li><strong>å®¡è®¡æ—¥å¿—</strong>ï¼šå®Œæ•´çš„æ•°æ®è®¿é—®è®°å½•</li>
<li><strong>åˆè§„æ”¯æŒ</strong>ï¼šæ»¡è¶³ä¼ä¸šå®‰å…¨æ ‡å‡†</li>
</ul>
<h3 id="å®æ–½å»ºè®®"><a href="#å®æ–½å»ºè®®" class="headerlink" title="å®æ–½å»ºè®®"></a>å®æ–½å»ºè®®</h3><h4 id="åˆ†é˜¶æ®µå®æ–½"><a href="#åˆ†é˜¶æ®µå®æ–½" class="headerlink" title="åˆ†é˜¶æ®µå®æ–½"></a>åˆ†é˜¶æ®µå®æ–½</h4><ol>
<li><strong>åŸå‹é˜¶æ®µ</strong>ï¼šæ­å»ºæœ€å°å¯ç”¨ç³»ç»Ÿï¼ŒéªŒè¯æ ¸å¿ƒåŠŸèƒ½</li>
<li><strong>æ‰©å±•é˜¶æ®µ</strong>ï¼šå¢åŠ æ›´å¤šæ•°æ®æºå’Œä¼˜åŒ–æ€§èƒ½</li>
<li><strong>ç”Ÿäº§é˜¶æ®µ</strong>ï¼šå®Œå–„ç›‘æ§ã€å¤‡ä»½å’Œç¾å¤‡æ–¹æ¡ˆ</li>
<li><strong>ä¼˜åŒ–é˜¶æ®µ</strong>ï¼šæŒç»­ä¼˜åŒ–ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿæ€§èƒ½</li>
</ol>
<h4 id="æˆåŠŸå…³é”®å› ç´ "><a href="#æˆåŠŸå…³é”®å› ç´ " class="headerlink" title="æˆåŠŸå…³é”®å› ç´ "></a>æˆåŠŸå…³é”®å› ç´ </h4><ol>
<li><strong>æ•°æ®è´¨é‡</strong>ï¼šé«˜è´¨é‡çš„æ•°æ®æ˜¯ç³»ç»ŸæˆåŠŸçš„åŸºç¡€</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šç®€æ´æ˜“ç”¨çš„ç•Œé¢å’Œå¿«é€Ÿçš„å“åº”</li>
<li><strong>æŒç»­ç»´æŠ¤</strong>ï¼šå®šæœŸæ›´æ–°çŸ¥è¯†åº“å’Œä¼˜åŒ–ç³»ç»Ÿ</li>
<li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šè·¨éƒ¨é—¨åä½œä¿è¯ç³»ç»Ÿä»·å€¼æœ€å¤§åŒ–</li>
</ol>
<h3 id="æœªæ¥å±•æœ›"><a href="#æœªæ¥å±•æœ›" class="headerlink" title="æœªæ¥å±•æœ›"></a>æœªæ¥å±•æœ›</h3><p>éšç€æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œä¼ä¸šçº§RAGç³»ç»Ÿå°†åœ¨ä»¥ä¸‹æ–¹å‘ç»§ç»­æ¼”è¿›ï¼š</p>
<ol>
<li><strong>å¤šæ¨¡æ€æ”¯æŒ</strong>ï¼šä¸ä»…æ”¯æŒæ–‡æœ¬ï¼Œè¿˜æ”¯æŒå›¾åƒã€éŸ³é¢‘ç­‰å¤šç§æ¨¡æ€</li>
<li><strong>æ·±åº¦å­¦ä¹ ä¼˜åŒ–</strong>ï¼šä½¿ç”¨æ›´å…ˆè¿›çš„æ¨¡å‹æå‡ç†è§£å’Œç”Ÿæˆèƒ½åŠ›</li>
<li><strong>ä¸ªæ€§åŒ–å®šåˆ¶</strong>ï¼šæ ¹æ®ç”¨æˆ·è§’è‰²å’Œåå¥½æä¾›ä¸ªæ€§åŒ–æœåŠ¡</li>
<li><strong>è‡ªåŠ¨åŒ–è¿ç»´</strong>ï¼šåŸºäºAIçš„è‡ªåŠ¨åŒ–ç›‘æ§å’Œæ•…éšœæ¢å¤</li>
</ol>
<p>é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„Java+Milvusä¼ä¸šçº§RAGç³»ç»Ÿï¼Œä¼ä¸šå¯ä»¥æœ‰æ•ˆåˆ©ç”¨å†…éƒ¨çŸ¥è¯†èµ„äº§ï¼Œæå‡å‘˜å·¥å·¥ä½œæ•ˆç‡ï¼Œä¸ºæ•°å­—åŒ–è½¬å‹æä¾›å¼ºå¤§æ”¯æ’‘ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol>
<li><a target="_blank" rel="noopener" href="https://milvus.io/docs">Milvuså®˜æ–¹æ–‡æ¡£</a></li>
<li><a target="_blank" rel="noopener" href="https://platform.openai.com/docs/guides/embeddings">OpenAI EmbeddingsæŒ‡å—</a></li>
<li><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-boot">Spring Bootå®˜æ–¹æ–‡æ¡£</a></li>
<li><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2005.11401">RAGæŠ€æœ¯è¯¦è§£</a></li>
<li><a target="_blank" rel="noopener" href="https://milvus.io/blog">å‘é‡æ•°æ®åº“æœ€ä½³å®è·µ</a></li>
<li><a target="_blank" rel="noopener" href="https://www.thoughtworks.com/radar/techniques/knowledge-graphs">ä¼ä¸šçŸ¥è¯†åº“æ¶æ„è®¾è®¡</a></li>
</ol>
<hr>
<p><strong>æœ¬æ–‡ä»£ç å·²å¼€æº</strong>ï¼š<a target="_blank" rel="noopener" href="https://github.com/your-org/enterprise-rag">https://github.com/your-org/enterprise-rag</a></p>
<p><strong>æŠ€æœ¯äº¤æµç¾¤</strong>ï¼šæ‰«æäºŒç»´ç åŠ å…¥ä¼ä¸šçº§RAGæŠ€æœ¯äº¤æµç¾¤</p>
<p><em>æœ€åæ›´æ–°æ—¶é—´ï¼š2025-09-03</em></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://foamtomato.github.io">FoamğŸ…</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://foamtomato.github.io/2025/08/03/0.5.7-Java+Milvus%E6%90%AD%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%BA%A7RAG%E7%B3%BB%E7%BB%9F/">https://foamtomato.github.io/2025/08/03/0.5.7-Java+Milvus%E6%90%AD%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%BA%A7RAG%E7%B3%BB%E7%BB%9F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://foamtomato.github.io" target="_blank">å–µå–µé±¼å¡˜</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/">å¤§è¯­è¨€æ¨¡å‹</a><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Spring-Boot/">Spring Boot</a><a class="post-meta__tags" href="/tags/%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93/">å‘é‡æ•°æ®åº“</a><a class="post-meta__tags" href="/tags/Milvus/">Milvus</a><a class="post-meta__tags" href="/tags/%E6%A3%80%E7%B4%A2%E5%A2%9E%E5%BC%BA%E7%94%9F%E6%88%90/">æ£€ç´¢å¢å¼ºç”Ÿæˆ</a><a class="post-meta__tags" href="/tags/%E5%90%91%E9%87%8F%E6%A3%80%E7%B4%A2/">å‘é‡æ£€ç´¢</a><a class="post-meta__tags" href="/tags/RAG/">RAG</a><a class="post-meta__tags" href="/tags/%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8/">ä¼ä¸šåº”ç”¨</a><a class="post-meta__tags" href="/tags/%E4%BC%81%E4%B8%9A%E7%9F%A5%E8%AF%86%E5%BA%93/">ä¼ä¸šçŸ¥è¯†åº“</a></div><div class="post_share"><div class="social-share" data-image="https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&amp;h=600&amp;fit=crop" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2025/01/21/0.5.6-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%B8%BB%E6%B5%81%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94/" title="å‘é‡æ•°æ®åº“æ­å»ºä¸ä¸»æµäº§å“å¯¹æ¯”"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800&amp;h=600&amp;fit=crop" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">å‘é‡æ•°æ®åº“æ­å»ºä¸ä¸»æµäº§å“å¯¹æ¯”</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2025/01/21/0.5.6-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%B8%BB%E6%B5%81%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94/" title="å‘é‡æ•°æ®åº“æ­å»ºä¸ä¸»æµäº§å“å¯¹æ¯”"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800&h=600&fit=crop" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-21</div><div class="title">å‘é‡æ•°æ®åº“æ­å»ºä¸ä¸»æµäº§å“å¯¹æ¯”</div></div></a></div><div><a href="/2025/01/15/0.5.2-LangChain4j%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84LLM%E5%BA%94%E7%94%A8/" title="LangChain4jæ‰“é€ è‡ªå·±çš„LLMåº”ç”¨"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&h=600&fit=crop" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-15</div><div class="title">LangChain4jæ‰“é€ è‡ªå·±çš„LLMåº”ç”¨</div></div></a></div><div><a href="/2025/01/16/0.5.3-SpringAI%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84LLM%E5%BA%94%E7%94%A8/" title="Spring AIæ‰“é€ è‡ªå·±çš„LLMåº”ç”¨"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.unsplash.com/photo-1555949963-aa79dcee981c?w=800&h=600&fit=crop" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-16</div><div class="title">Spring AIæ‰“é€ è‡ªå·±çš„LLMåº”ç”¨</div></div></a></div><div><a href="/2025/01/17/0.5.4-Java%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BEMCP%E5%AE%9A%E5%88%B6%E6%97%85%E6%B8%B8%E8%B7%AF%E7%BA%BF/" title="Javaé«˜å¾·åœ°å›¾MCPå®šåˆ¶æ—…æ¸¸è·¯çº¿"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=800&h=600&fit=crop" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-17</div><div class="title">Javaé«˜å¾·åœ°å›¾MCPå®šåˆ¶æ—…æ¸¸è·¯çº¿</div></div></a></div><div><a href="/2025/01/20/0.5.5-Java%E5%BC%82%E5%B8%B8%E6%97%A5%E5%BF%97MCP%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/" title="Javaå¼‚å¸¸æ—¥å¿—MCPæœåŠ¡æ¶æ„"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&h=600&fit=crop" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-20</div><div class="title">Javaå¼‚å¸¸æ—¥å¿—MCPæœåŠ¡æ¶æ„</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.ico" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">FoamğŸ…</div><div class="author-info__description">ç”¨èƒ½åŠ›æ¢æ—¶é—´ï¼Œç”¨æ—¶é—´æ¢èƒ½åŠ›</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">57</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">68</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">å·¥ä½œç¹å¿™ï¼Œä¸ä¼šå®šæœŸæ›´æ–°ï¼ï¼ï¼</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">å¼•è¨€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%BC%81%E4%B8%9A%E7%BA%A7RAG%E7%B3%BB%E7%BB%9F%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆéœ€è¦ä¼ä¸šçº§RAGç³»ç»Ÿï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RAG%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text">RAGæŠ€æœ¯åŸç†è¯¦è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E8%A7%A3%E6%9E%90"><span class="toc-number">2.1.</span> <span class="toc-text">æ ¸å¿ƒç»„ä»¶è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%96%87%E6%A1%A3%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6%EF%BC%88Document-Processing%EF%BC%89"><span class="toc-number">2.1.1.</span> <span class="toc-text">1. æ–‡æ¡£å¤„ç†ç»„ä»¶ï¼ˆDocument Processingï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%90%91%E9%87%8F%E6%A3%80%E7%B4%A2%E7%BB%84%E4%BB%B6%EF%BC%88Vector-Search%EF%BC%89"><span class="toc-number">2.1.2.</span> <span class="toc-text">2. å‘é‡æ£€ç´¢ç»„ä»¶ï¼ˆVector Searchï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%94%9F%E6%88%90%E5%A2%9E%E5%BC%BA%E7%BB%84%E4%BB%B6%EF%BC%88Generation-Augmentation%EF%BC%89"><span class="toc-number">2.1.3.</span> <span class="toc-text">3. ç”Ÿæˆå¢å¼ºç»„ä»¶ï¼ˆGeneration Augmentationï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B%E5%88%86%E6%9E%90"><span class="toc-number">2.2.</span> <span class="toc-text">æŠ€æœ¯é€‰å‹åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9Milvus%EF%BC%9F"><span class="toc-number">2.2.1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆé€‰æ‹©Milvusï¼Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.</span> <span class="toc-text">ç³»ç»Ÿæ¶æ„è®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="toc-number">3.1.</span> <span class="toc-text">æ•´ä½“æ¶æ„å›¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E6%A8%A1%E5%9D%97%E8%81%8C%E8%B4%A3%E5%88%86%E6%9E%90"><span class="toc-number">3.2.</span> <span class="toc-text">å„æ¨¡å—èŒè´£åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%85%A5%E5%B1%82"><span class="toc-number">3.2.1.</span> <span class="toc-text">1. æ•°æ®æ¥å…¥å±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%96%87%E6%A1%A3%E5%A4%84%E7%90%86%E5%B1%82"><span class="toc-number">3.2.2.</span> <span class="toc-text">2. æ–‡æ¡£å¤„ç†å±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%90%91%E9%87%8F%E6%A3%80%E7%B4%A2%E5%B1%82"><span class="toc-number">3.2.3.</span> <span class="toc-text">3. å‘é‡æ£€ç´¢å±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E7%94%9F%E6%88%90%E5%A2%9E%E5%BC%BA%E5%B1%82"><span class="toc-number">3.2.4.</span> <span class="toc-text">4. ç”Ÿæˆå¢å¼ºå±‚</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E4%B8%8E%E9%83%A8%E7%BD%B2"><span class="toc-number">4.</span> <span class="toc-text">ç¯å¢ƒå‡†å¤‡ä¸éƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.</span> <span class="toc-text">å¼€å‘ç¯å¢ƒé…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Java%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82"><span class="toc-number">4.1.1.</span> <span class="toc-text">1. Javaç¯å¢ƒè¦æ±‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A0%B8%E5%BF%83%E4%BE%9D%E8%B5%96%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.2.</span> <span class="toc-text">2. æ ¸å¿ƒä¾èµ–é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Milvus%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88"><span class="toc-number">4.2.</span> <span class="toc-text">Milvuséƒ¨ç½²æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2%EF%BC%88%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%EF%BC%89"><span class="toc-number">4.2.1.</span> <span class="toc-text">1. å•æœºéƒ¨ç½²ï¼ˆå¼€å‘ç¯å¢ƒï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%EF%BC%88%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%EF%BC%89"><span class="toc-number">4.2.2.</span> <span class="toc-text">2. é›†ç¾¤éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81"><span class="toc-number">5.</span> <span class="toc-text">æ ¸å¿ƒå®ç°ä»£ç </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.1.</span> <span class="toc-text">1. é…ç½®æ–‡ä»¶è®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%96%87%E6%A1%A3%E5%A4%84%E7%90%86%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.2.</span> <span class="toc-text">2. æ–‡æ¡£å¤„ç†æœåŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Milvus%E6%9C%8D%E5%8A%A1%E5%B0%81%E8%A3%85"><span class="toc-number">5.3.</span> <span class="toc-text">3. MilvusæœåŠ¡å°è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%A3%80%E7%B4%A2%E5%A2%9E%E5%BC%BA%E7%94%9F%E6%88%90%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.4.</span> <span class="toc-text">4. æ£€ç´¢å¢å¼ºç”ŸæˆæœåŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%90%91%E9%87%8F%E5%8C%96%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.5.</span> <span class="toc-text">5. å‘é‡åŒ–æœåŠ¡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-number">6.</span> <span class="toc-text">æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96"><span class="toc-number">6.1.</span> <span class="toc-text">1. ç´¢å¼•ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="toc-number">6.2.</span> <span class="toc-text">2. ç¼“å­˜ç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="toc-number">6.3.</span> <span class="toc-text">3. å¹¶å‘æ§åˆ¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7%E5%92%8C%E8%BF%90%E7%BB%B4"><span class="toc-number">7.</span> <span class="toc-text">ç›‘æ§å’Œè¿ç»´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="toc-number">7.1.</span> <span class="toc-text">1. æŒ‡æ ‡ç›‘æ§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5"><span class="toc-number">7.2.</span> <span class="toc-text">2. å¥åº·æ£€æŸ¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%92%8C%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">8.</span> <span class="toc-text">æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">8.1.</span> <span class="toc-text">1. æ•°æ®ç®¡ç†æœ€ä½³å®è·µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-number">8.1.1.</span> <span class="toc-text">æ–‡æ¡£é¢„å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5%E4%BC%98%E5%8C%96"><span class="toc-number">8.1.2.</span> <span class="toc-text">åˆ†å—ç­–ç•¥ä¼˜åŒ–</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="toc-number">8.2.</span> <span class="toc-text">2. æ€§èƒ½ä¼˜åŒ–å»ºè®®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">8.2.1.</span> <span class="toc-text">æŸ¥è¯¢ä¼˜åŒ–</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AE%89%E5%85%A8%E5%92%8C%E5%90%88%E8%A7%84%E8%80%83%E8%99%91"><span class="toc-number">8.3.</span> <span class="toc-text">3. å®‰å…¨å’Œåˆè§„è€ƒè™‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8"><span class="toc-number">8.3.1.</span> <span class="toc-text">æ•°æ®å®‰å…¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E7%BB%B4"><span class="toc-number">9.</span> <span class="toc-text">éƒ¨ç½²å’Œè¿ç»´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2"><span class="toc-number">9.1.</span> <span class="toc-text">1. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-Compose%E9%83%A8%E7%BD%B2"><span class="toc-number">9.1.1.</span> <span class="toc-text">Docker Composeéƒ¨ç½²</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Kubernetes%E9%83%A8%E7%BD%B2"><span class="toc-number">9.1.2.</span> <span class="toc-text">Kuberneteséƒ¨ç½²</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6%E9%85%8D%E7%BD%AE"><span class="toc-number">9.2.</span> <span class="toc-text">2. ç›‘æ§å‘Šè­¦é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">10.</span> <span class="toc-text">æ€»ç»“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E4%BB%B7%E5%80%BC"><span class="toc-number">10.1.</span> <span class="toc-text">æ ¸å¿ƒä»·å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E4%BA%AE%E7%82%B9"><span class="toc-number">10.2.</span> <span class="toc-text">æŠ€æœ¯äº®ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8A%BF"><span class="toc-number">10.2.1.</span> <span class="toc-text">æ¶æ„ä¼˜åŠ¿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">10.2.2.</span> <span class="toc-text">æ€§èƒ½ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E5%90%88%E8%A7%84"><span class="toc-number">10.2.3.</span> <span class="toc-text">å®‰å…¨åˆè§„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%96%BD%E5%BB%BA%E8%AE%AE"><span class="toc-number">10.3.</span> <span class="toc-text">å®æ–½å»ºè®®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%98%B6%E6%AE%B5%E5%AE%9E%E6%96%BD"><span class="toc-number">10.3.1.</span> <span class="toc-text">åˆ†é˜¶æ®µå®æ–½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%90%E5%8A%9F%E5%85%B3%E9%94%AE%E5%9B%A0%E7%B4%A0"><span class="toc-number">10.3.2.</span> <span class="toc-text">æˆåŠŸå…³é”®å› ç´ </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B"><span class="toc-number">10.4.</span> <span class="toc-text">æœªæ¥å±•æœ›</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">11.</span> <span class="toc-text">å‚è€ƒèµ„æ–™</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/08/03/0.5.7-Java+Milvus%E6%90%AD%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%BA%A7RAG%E7%B3%BB%E7%BB%9F/" title="Java+Milvusæ­å»ºä¼ä¸šçº§RAGç³»ç»Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&amp;h=600&amp;fit=crop" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java+Milvusæ­å»ºä¼ä¸šçº§RAGç³»ç»Ÿ"/></a><div class="content"><a class="title" href="/2025/08/03/0.5.7-Java+Milvus%E6%90%AD%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%BA%A7RAG%E7%B3%BB%E7%BB%9F/" title="Java+Milvusæ­å»ºä¼ä¸šçº§RAGç³»ç»Ÿ">Java+Milvusæ­å»ºä¼ä¸šçº§RAGç³»ç»Ÿ</a><time datetime="2025-08-03T07:56:49.000Z" title="å‘è¡¨äº 2025-08-03 15:56:49">2025-08-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/21/0.5.6-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%B8%BB%E6%B5%81%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94/" title="å‘é‡æ•°æ®åº“æ­å»ºä¸ä¸»æµäº§å“å¯¹æ¯”"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800&amp;h=600&amp;fit=crop" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å‘é‡æ•°æ®åº“æ­å»ºä¸ä¸»æµäº§å“å¯¹æ¯”"/></a><div class="content"><a class="title" href="/2025/01/21/0.5.6-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%B8%BB%E6%B5%81%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94/" title="å‘é‡æ•°æ®åº“æ­å»ºä¸ä¸»æµäº§å“å¯¹æ¯”">å‘é‡æ•°æ®åº“æ­å»ºä¸ä¸»æµäº§å“å¯¹æ¯”</a><time datetime="2025-01-21T06:30:45.000Z" title="å‘è¡¨äº 2025-01-21 14:30:45">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/20/0.5.5-Java%E5%BC%82%E5%B8%B8%E6%97%A5%E5%BF%97MCP%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/" title="Javaå¼‚å¸¸æ—¥å¿—MCPæœåŠ¡æ¶æ„"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&amp;h=600&amp;fit=crop" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Javaå¼‚å¸¸æ—¥å¿—MCPæœåŠ¡æ¶æ„"/></a><div class="content"><a class="title" href="/2025/01/20/0.5.5-Java%E5%BC%82%E5%B8%B8%E6%97%A5%E5%BF%97MCP%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84/" title="Javaå¼‚å¸¸æ—¥å¿—MCPæœåŠ¡æ¶æ„">Javaå¼‚å¸¸æ—¥å¿—MCPæœåŠ¡æ¶æ„</a><time datetime="2025-01-20T08:45:30.000Z" title="å‘è¡¨äº 2025-01-20 16:45:30">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/17/0.5.4-Java%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BEMCP%E5%AE%9A%E5%88%B6%E6%97%85%E6%B8%B8%E8%B7%AF%E7%BA%BF/" title="Javaé«˜å¾·åœ°å›¾MCPå®šåˆ¶æ—…æ¸¸è·¯çº¿"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=800&amp;h=600&amp;fit=crop" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Javaé«˜å¾·åœ°å›¾MCPå®šåˆ¶æ—…æ¸¸è·¯çº¿"/></a><div class="content"><a class="title" href="/2025/01/17/0.5.4-Java%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BEMCP%E5%AE%9A%E5%88%B6%E6%97%85%E6%B8%B8%E8%B7%AF%E7%BA%BF/" title="Javaé«˜å¾·åœ°å›¾MCPå®šåˆ¶æ—…æ¸¸è·¯çº¿">Javaé«˜å¾·åœ°å›¾MCPå®šåˆ¶æ—…æ¸¸è·¯çº¿</a><time datetime="2025-01-17T02:30:00.000Z" title="å‘è¡¨äº 2025-01-17 10:30:00">2025-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/16/0.5.3-SpringAI%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84LLM%E5%BA%94%E7%94%A8/" title="Spring AIæ‰“é€ è‡ªå·±çš„LLMåº”ç”¨"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://images.unsplash.com/photo-1555949963-aa79dcee981c?w=800&amp;h=600&amp;fit=crop" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring AIæ‰“é€ è‡ªå·±çš„LLMåº”ç”¨"/></a><div class="content"><a class="title" href="/2025/01/16/0.5.3-SpringAI%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84LLM%E5%BA%94%E7%94%A8/" title="Spring AIæ‰“é€ è‡ªå·±çš„LLMåº”ç”¨">Spring AIæ‰“é€ è‡ªå·±çš„LLMåº”ç”¨</a><time datetime="2025-01-16T06:30:00.000Z" title="å‘è¡¨äº 2025-01-16 14:30:00">2025-01-16</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By FoamğŸ…</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid@10.8.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --><script data-pjax>function history_calendar_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>é‚£å¹´ä»Šæ—¥</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>';
                // console.log('å·²æŒ‚è½½history_calendar') // æ—¥å¿—å·²æ¸…ç†
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // æ— æŠ¥é”™ï¼Œä½†ä¸å½±å“ä½¿ç”¨(æ”¯æŒpjaxè·³è½¬)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // æœ‰æŠ¥é”™ï¼Œä½†ä¸å½±å“ä½¿ç”¨(æ”¯æŒpjaxè·³è½¬)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='all'|| 'all' ==='all')){

            history_calendar_injector_config()
        } </script><script data-pjax  src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script data-pjax>function electric_clock_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-clock/clock/images/weather/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading" class="entered loading"></div></div></div></div></div>';
                // console.log('å·²æŒ‚è½½electric_clock') // æ—¥å¿—å·²æ¸…ç†
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // æ— æŠ¥é”™ï¼Œä½†ä¸å½±å“ä½¿ç”¨(æ”¯æŒpjaxè·³è½¬)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // æœ‰æŠ¥é”™ï¼Œä½†ä¸å½±å“ä½¿ç”¨(æ”¯æŒpjaxè·³è½¬)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='all'|| 'all' ==='all')){

            electric_clock_injector_config()
        } </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax  src="/js/clock.js"></script><!-- hexo injector body_end end --></body></html>
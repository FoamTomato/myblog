<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒçŸ¥å¤©æ°”APIæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #007bff;
            background-color: #f8f9fa;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            font-family: monospace;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ¤ï¸ å¿ƒçŸ¥å¤©æ°”APIæµ‹è¯•</h1>

        <div class="test-section">
            <h3>APIæµ‹è¯•</h3>
            <p>æµ‹è¯•å¿ƒçŸ¥å¤©æ°”APIè°ƒç”¨: <code>https://weather.seniverse.com/?token=db45abab-26a9-47e6-a965-3fc69ed9509a</code></p>
            <button onclick="testAPI()">æµ‹è¯•API</button>
            <button onclick="clearResult()">æ¸…é™¤ç»“æœ</button>
            <div id="api-result" class="result">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <div class="test-section">
            <h3>æ—¶é’Ÿæ’ä»¶æµ‹è¯•</h3>
            <p>æµ‹è¯•æ—¶é’Ÿæ’ä»¶çš„å¤©æ°”åŠŸèƒ½</p>
            <button onclick="testClock()">æµ‹è¯•æ—¶é’Ÿ</button>
            <div id="clock-result" class="result">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <div class="test-section">
            <h3>ä½¿ç”¨è¯´æ˜</h3>
            <ul>
                <li><strong>APIæµ‹è¯•:</strong> ç›´æ¥æµ‹è¯•å¿ƒçŸ¥å¤©æ°”APIçš„å“åº”</li>
                <li><strong>æ—¶é’Ÿæµ‹è¯•:</strong> æµ‹è¯•å®Œæ•´çš„æ—¶é’Ÿæ’ä»¶åŠŸèƒ½</li>
                <li><strong>æ§åˆ¶å°:</strong> æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°äº†è§£è¯¦ç»†æ—¥å¿—</li>
            </ul>
        </div>
    </div>

    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '<span class="info">ğŸ”„ æ­£åœ¨è°ƒç”¨å¿ƒçŸ¥å¤©æ°”API...</span>';

            try {
                const response = await fetch('https://weather.seniverse.com/?token=db45abab-26a9-47e6-a965-3fc69ed9509a');

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `
                        <div class="success">âœ… APIè°ƒç”¨æˆåŠŸ!</div>
                        <strong>å“åº”æ•°æ®:</strong><br>
                        ${JSON.stringify(data, null, 2)}
                    `;
                    console.log('å¿ƒçŸ¥å¤©æ°”APIå“åº”:', data);
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">âŒ APIè°ƒç”¨å¤±è´¥!</div>
                        çŠ¶æ€ç : ${response.status}<br>
                        é”™è¯¯ä¿¡æ¯: ${response.statusText}
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">âŒ ç½‘ç»œé”™è¯¯!</div>
                    é”™è¯¯ä¿¡æ¯: ${error.message}
                `;
                console.error('APIæµ‹è¯•é”™è¯¯:', error);
            }
        }

        async function testClock() {
            const resultDiv = document.getElementById('clock-result');
            resultDiv.innerHTML = '<span class="info">ğŸ”„ æ­£åœ¨æµ‹è¯•æ—¶é’Ÿæ’ä»¶...</span>';

            try {
                // æ¨¡æ‹Ÿæ—¶é’Ÿæ’ä»¶çš„getWeatherDataForClockå‡½æ•°
                const data = await getWeatherDataForClock();

                if (data) {
                    resultDiv.innerHTML = `
                        <div class="success">âœ… æ—¶é’Ÿæ’ä»¶æµ‹è¯•æˆåŠŸ!</div>
                        <strong>å¤©æ°”æ•°æ®:</strong><br>
                        ä½ç½®: ${data.location}<br>
                        å¤©æ°”: ${data.weather}<br>
                        æ¸©åº¦: ${data.temp}<br>
                        æ¹¿åº¦: ${data.humidity}
                    `;
                } else {
                    resultDiv.innerHTML = '<div class="error">âŒ æ—¶é’Ÿæ’ä»¶è¿”å›ç©ºæ•°æ®</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">âŒ æ—¶é’Ÿæ’ä»¶æµ‹è¯•å¤±è´¥!</div>
                    é”™è¯¯ä¿¡æ¯: ${error.message}
                `;
                console.error('æ—¶é’Ÿæµ‹è¯•é”™è¯¯:', error);
            }
        }

        // å¤åˆ¶æ—¶é’Ÿæ’ä»¶çš„æ ¸å¿ƒå‡½æ•°
        async function getWeatherDataForClock() {
            try {
                const userLocation = await getUserLocation();
                console.log('ğŸŒ¤ï¸ è·å–å¤©æ°”æ•°æ®ï¼Œä½ç½®:', userLocation);

                const result = await getSeniverseWeather(userLocation);
                if (result) {
                    console.log('âœ… å¿ƒçŸ¥å¤©æ°”è·å–æˆåŠŸ:', result);
                    return result;
                }
            } catch (error) {
                console.warn('âŒ å¿ƒçŸ¥å¤©æ°”APIè°ƒç”¨å¤±è´¥:', error);
            }

            return {
                location: 'åŒ—äº¬',
                weather: 'â˜€ï¸ æ™´',
                temp: '+25Â°C',
                humidity: '60%'
            };
        }

        async function getUserLocation() {
            // ç®€åŒ–ç‰ˆæœ¬ï¼Œç›´æ¥è¿”å›åŒ—äº¬
            return 'åŒ—äº¬';
        }

        async function getSeniverseWeather(location) {
            console.log('ğŸŒ¤ï¸ è°ƒç”¨å¿ƒçŸ¥å¤©æ°”APIï¼Œä½ç½®:', location);

            try {
                const response = await fetch(`https://weather.seniverse.com/?token=db45abab-26a9-47e6-a965-3fc69ed9509a`);

                if (response.ok) {
                    const data = await response.json();
                    console.log('âœ… å¿ƒçŸ¥å¤©æ°”APIå“åº”:', data);

                    if (data && data.results && data.results.length > 0) {
                        const weather = data.results[0];
                        const current = weather.now;

                        const weatherText = getSeniverseWeatherText(current.code);

                        return {
                            location: weather.location.name,
                            weather: weatherText,
                            temp: current.temperature + 'Â°C',
                            humidity: current.humidity + '%'
                        };
                    }
                } else {
                    console.warn('âŒ å¿ƒçŸ¥å¤©æ°”APIè¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç :', response.status);
                }
            } catch (error) {
                console.warn('âŒ å¿ƒçŸ¥å¤©æ°”APIè°ƒç”¨å¼‚å¸¸:', error);
            }

            return null;
        }

        function getSeniverseWeatherText(code) {
            const weatherCodeMap = {
                '0': 'æ™´', '1': 'æ™´', '2': 'æ™´', '3': 'æ™´', '4': 'å¤šäº‘',
                '5': 'æ™´é—´å¤šäº‘', '6': 'æ™´é—´å¤šäº‘', '7': 'å¤§éƒ¨å¤šäº‘', '8': 'å¤§éƒ¨å¤šäº‘',
                '9': 'é˜´', '10': 'é˜µé›¨', '11': 'é›·é˜µé›¨', '12': 'é›·é˜µé›¨ä¼´æœ‰å†°é›¹',
                '13': 'å°é›¨', '14': 'ä¸­é›¨', '15': 'å¤§é›¨', '16': 'æš´é›¨',
                '17': 'å¤§æš´é›¨', '18': 'ç‰¹å¤§æš´é›¨', '19': 'å†»é›¨', '20': 'é›¨å¤¹é›ª',
                '21': 'é˜µé›ª', '22': 'å°é›ª', '23': 'ä¸­é›ª', '24': 'å¤§é›ª',
                '25': 'æš´é›ª', '26': 'æµ®å°˜', '27': 'æ‰¬æ²™', '28': 'æ²™å°˜æš´',
                '29': 'å¼ºæ²™å°˜æš´', '30': 'é›¾', '31': 'éœ¾', '32': 'é£',
                '33': 'å¤§é£', '34': 'é£“é£', '35': 'çƒ­å¸¦é£æš´', '36': 'é¾™å·é£',
                '37': 'å†·', '38': 'çƒ­', '99': 'æœªçŸ¥'
            };

            return weatherCodeMap[code] || 'æœªçŸ¥';
        }

        function clearResult() {
            document.getElementById('api-result').innerHTML = 'ç­‰å¾…æµ‹è¯•...';
            document.getElementById('clock-result').innerHTML = 'ç­‰å¾…æµ‹è¯•...';
        }
    </script>
</body>
</html>

# 🚀 Hexo 博客增强版部署脚本使用指南

## 📋 概述

这是为Hexo博客打造的增强版自动化部署脚本，集成了您要求的三项核心功能：

- ✅ **自动使用系统代理** - 智能检测和配置代理设置
- ✅ **自动清理hexo并且打包推送** - 深度清理和智能部署
- ✅ **自动把代码推送到git** - 智能源码管理和推送

## ✨ 主要特性

### 🔍 智能代理自动检测
- 自动检测环境变量代理设置
- 支持macOS系统代理配置
- 扫描常用代理端口（7890, 7897, 1080等）
- 支持Clash等代理软件配置
- 自动配置Git代理设置

### 🧹 深度清理和优化
- 清理Hexo缓存文件
- 清理Node.js缓存
- 清理npm缓存
- 清理系统临时文件
- 智能清理Git未跟踪文件

### 📊 详细统计和日志
- 构建时间统计
- 文件数量和大小统计
- 系统信息记录
- 自动生成部署日志文件
- 详细的错误信息和解决建议

### ✅ 完整验证机制
- 部署前环境验证
- 配置文件检查
- 依赖检查
- 网络连接测试
- 磁盘空间检查
- 部署后验证

## 🚀 快速开始

### 1. 基本使用

```bash
# 🔥 一键完整部署（推荐）
./deploy.sh --all

# 仅验证环境
./deploy.sh --validate

# 手动选择步骤
./deploy.sh -c -g -d
```

### 2. 高级用法

```bash
# 本地预览测试
./deploy.sh --preview

# 离线环境测试
./deploy.sh --offline

# 仅清理缓存
./deploy.sh --clean

# 仅生成静态文件
./deploy.sh --generate

# 仅部署到GitHub Pages
./deploy.sh --deploy

# 仅推送源码
./deploy.sh --push
```

## 📖 详细功能说明

### 自动代理检测流程

1. **环境变量检测** - 检查`http_proxy`和`https_proxy`
2. **Git配置检测** - 检查Git全局代理设置
3. **macOS系统代理** - 检测系统网络偏好设置
4. **代理配置文件** - 读取`.proxy-config`文件
5. **端口扫描** - 扫描常用代理端口
6. **代理软件检测** - 检测Clash等代理软件
7. **自动配置** - 自动设置Git代理

### 完整部署流程 (--all)

```
🔍 部署前验证 → 🌐 代理检测 → 🧹 深度清理 → 📝 Git状态检查
    ↓
🏗️ 生成静态文件 → 🚀 GitHub Pages部署 → 📤 源码推送
    ↓
📊 部署统计 → 📝 日志记录
```

### 智能Git推送功能

- **分支检查** - 自动检测当前分支
- **状态分析** - 分析文件更改类型
- **智能提交信息** - 根据更改类型生成提交信息
- **推送验证** - 验证推送结果
- **统计显示** - 显示推送统计信息

## 🔧 配置说明

### 代理配置

创建`.proxy-config`文件：
```bash
# .proxy-config
HTTP_PROXY="http://127.0.0.1:7890"
HTTPS_PROXY="http://127.0.0.1:7890"
ALL_PROXY="socks5://127.0.0.1:7890"
```

### 环境变量

```bash
export http_proxy="http://127.0.0.1:7890"
export https_proxy="http://127.0.0.1:7890"
```

## 📊 统计信息

### 部署统计报告示例

```
📊 部署统计报告
========================================
⏰ 时间统计:
   构建耗时: 45秒
   部署耗时: 12秒
   总耗时: 67秒

📁 文件统计:
   生成文件数: 181
   部署大小: 25MB

💻 系统信息:
   操作系统: Darwin arm64
   Node.js版本: v18.17.0
   Hexo版本: 6.3.0
   Git版本: 2.39.3

🌐 网络代理: http://127.0.0.1:7890
========================================
```

### 部署日志文件

每次部署会自动生成详细日志文件：
```
deploy-20250829-235329.log
```

## 🛠️ 故障排除

### 常见问题

#### 1. 代理检测失败
```bash
# 检查代理状态
curl -I https://github.com

# 手动设置代理
export http_proxy="http://127.0.0.1:7890"
export https_proxy="http://127.0.0.1:7890"
```

#### 2. Git推送失败
```bash
# 检查Git配置
git remote -v
git config --list | grep proxy

# 重新配置远程仓库
git remote set-url origin https://github.com/username/repo.git
```

#### 3. 部署失败
```bash
# 检查配置文件
cat _config.yml | grep deploy

# 验证GitHub Token
hexo deploy --dry-run
```

### 错误代码说明

- `0` - 成功
- `1` - 验证失败
- `2` - 构建失败
- `3` - 部署失败
- `4` - 推送失败

## 🎯 最佳实践

### 1. 日常部署
```bash
# 推荐的日常部署命令
./deploy.sh --all
```

### 2. 开发测试
```bash
# 本地预览
./deploy.sh --preview

# 验证环境
./deploy.sh --validate

# 离线测试
./deploy.sh --offline
```

### 3. 问题排查
```bash
# 仅清理
./deploy.sh --clean

# 仅生成
./deploy.sh --generate

# 仅部署
./deploy.sh --deploy
```

## 📈 性能优化

### 缓存策略
- 自动清理过期缓存
- 智能跳过无需重新生成的文件
- 优化构建时间

### 网络优化
- 自动选择最佳代理
- 并发下载依赖
- 重试机制

## 🔄 更新日志

### v2.0.0 (当前版本)
- ✨ 智能代理自动检测和配置
- 🧹 深度清理缓存和临时文件
- 📊 详细的部署统计和日志
- ✅ 完整的验证和错误处理
- 🎯 一键完整部署流程
- 📝 自动生成部署日志文件

### v1.0.0 (原版本)
- 基础的Hexo部署功能
- 简单的Git推送
- 基本的错误处理

## 📞 支持

如果遇到问题，请：

1. 查看部署日志文件
2. 运行 `./deploy.sh --validate` 检查环境
3. 查看本文档的故障排除部分
4. 检查GitHub Issues

## 🎉 总结

这个增强版部署脚本提供了：

- 🚀 **一键部署** - `./deploy.sh --all`
- 🔍 **智能代理** - 自动检测和配置
- 🧹 **深度清理** - 全面的缓存清理
- 📊 **详细统计** - 完整的部署报告
- ✅ **完整验证** - 前后验证机制
- 📝 **自动日志** - 详细的部署日志

让您的Hexo博客部署变得简单、高效、可靠！ 🎯✨
